<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Spring,Spring实战," />










<meta name="description" content="学习书籍：Spring实战第5版 源代码下载位置：https:&#x2F;&#x2F;github.com&#x2F;habuma&#x2F;spring-in-action-5-samples https:&#x2F;&#x2F;www.manning.com&#x2F;books&#x2F;spring-in-action-fifth-edition 第1部分 Spring基础第1章 Spring起步本章内容：  Spring 和 Spring Boot 的 必备 知识">
<meta property="og:type" content="article">
<meta property="og:title" content="Spring实战学习笔记">
<meta property="og:url" content="http://yoursite.com/2020/07/20/Spring%E5%AE%9E%E6%88%98%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/index.html">
<meta property="og:site_name" content="宋二的小窝">
<meta property="og:description" content="学习书籍：Spring实战第5版 源代码下载位置：https:&#x2F;&#x2F;github.com&#x2F;habuma&#x2F;spring-in-action-5-samples https:&#x2F;&#x2F;www.manning.com&#x2F;books&#x2F;spring-in-action-fifth-edition 第1部分 Spring基础第1章 Spring起步本章内容：  Spring 和 Spring Boot 的 必备 知识">
<meta property="og:image" content="https://pic.imgdb.cn/item/5f15a89e14195aa5944f626a.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/5f15abb214195aa594508be5.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/5f15abd014195aa594509eec.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/5f15ac2a14195aa59450c684.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/5f15ac4614195aa59450d543.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/5f15ac7a14195aa59450ef8d.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/5f15ac9714195aa59450fb91.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/5f15acc514195aa594510c4f.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/5f16effd14195aa594e58acc.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/5f16f4f214195aa594e801e3.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/5f16f7a514195aa594e8e427.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/5f1851b314195aa594804081.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/5f1851c214195aa5948048d3.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/5f18523214195aa5948098cf.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/5f18576c14195aa59484f030.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/5f185baf14195aa594888aca.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/5f199e6e14195aa594669c09.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/5f19a0e714195aa594689d7c.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/5f19a39d14195aa59469f9b3.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/5f1d783514195aa594bd5139.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/5f1d793b14195aa594be47fc.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/5f1d7c5d14195aa594c12964.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/5f1d830914195aa594c89d61.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/5f1d831514195aa594c8ad8b.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/5f20498214195aa594320c52.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/5f2048ad14195aa594313130.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/5f2048d414195aa59431598a.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/5f20491f14195aa59431a303.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/5f20492a14195aa59431ad1a.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/5f204cec14195aa5943663e8.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/5f204d2814195aa59436a08d.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/5f2183a914195aa5949aa72d.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/5f21841914195aa5949b18fa.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/5f2188ff14195aa5949df844.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/5f21894514195aa5949e2125.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/5f218a3c14195aa5949e9f39.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/5f218b5a14195aa5949f26ca.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/5f218caf14195aa5949fc990.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/5f218ce314195aa5949fe00e.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/5f22c67514195aa594300dc5.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/5f22c70014195aa594304c81.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/5f22c70f14195aa5943051de.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/5f22cbf014195aa594323f88.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/5f22cc2a14195aa594325955.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/5f22cc4314195aa59432631b.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/5f22d1b914195aa594352ac8.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/5f22d24c14195aa59435b5eb.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/5f22d29f14195aa59435e928.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/5f22d2c714195aa59435fb8d.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/5f22d31814195aa594361cac.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/5f22d33f14195aa594362c92.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/5f22d36514195aa594363c30.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/5f22d4ab14195aa59436bf5f.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/5f22d54414195aa59436faa6.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/5f22d8af14195aa594385d91.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/5f2432e614195aa594b76c30.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/5f24331714195aa594b77b11.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/5f24332914195aa594b780b8.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/5f24337214195aa594b79cc8.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/5f24360614195aa594b8b611.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/5f2436b614195aa594b8eaca.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/5f2436c314195aa594b8efec.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/5f2436d814195aa594b8f87b.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/5f24372714195aa594b915ba.jpg">
<meta property="article:published_time" content="2020-07-20T13:01:10.000Z">
<meta property="article:modified_time" content="2020-08-01T13:04:21.695Z">
<meta property="article:author" content="宋梓立 sorie">
<meta property="article:tag" content="Spring">
<meta property="article:tag" content="Spring实战">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://pic.imgdb.cn/item/5f15a89e14195aa5944f626a.jpg">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2020/07/20/Spring实战学习笔记/"/>





  <title>Spring实战学习笔记 | 宋二的小窝</title>
  








<meta name="generator" content="Hexo 4.2.1"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>
    <a href="https://github.com/Ewasong" target="_blank" rel="noopener" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">宋二的小窝</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/07/20/Spring%E5%AE%9E%E6%88%98%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="宋梓立 sorie">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/timg.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="宋二的小窝">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Spring实战学习笔记</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-07-20T21:01:10+08:00">
                2020-07-20
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2020/07/20/Spring%E5%AE%9E%E6%88%98%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2020/07/20/Spring%E5%AE%9E%E6%88%98%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>学习书籍：Spring实战第5版</p>
<p>源代码下载位置：<a href="https://github.com/habuma/spring-in-action-5-samples" target="_blank" rel="noopener">https://github.com/habuma/spring-in-action-5-samples</a></p>
<p><a href="https://www.manning.com/books/spring-in-action-fifth-edition" target="_blank" rel="noopener">https://www.manning.com/books/spring-in-action-fifth-edition</a></p>
<h1 id="第1部分-Spring基础"><a href="#第1部分-Spring基础" class="headerlink" title="第1部分 Spring基础"></a>第1部分 Spring基础</h1><h2 id="第1章-Spring起步"><a href="#第1章-Spring起步" class="headerlink" title="第1章 Spring起步"></a>第1章 Spring起步</h2><p>本章内容：</p>
<ul>
<li><p>Spring 和 Spring Boot 的 必备 知识</p>
</li>
<li><p>初始化Spring项目</p>
</li>
<li><p>Spring生态系统概览</p>
</li>
</ul>
<h3 id="1-1-什么是Spring"><a href="#1-1-什么是Spring" class="headerlink" title="1.1 什么是Spring"></a>1.1 什么是Spring</h3><p>​    Spring的核心是提供了一个容器(Container)，通常称为Spring应用上下文(Spring application context)，它们或创建和管理应用组件。这些组件也可以称为bean。</p>
<p>​    把bean装配在一起的行为是通过一种基于依赖注入的(dependency Injection, DI)的模式实现的。</p>
<p>​    组件不会在去创建它所依赖的组件并管理它们的生命周期，通过依赖注入，用容器来管理和维护所有组件，并且将其注入到需要它们的bean中。</p>
<p>​    通常通过构造器参数和属性访问来实现。</p>
<p>​    <img src="https://pic.imgdb.cn/item/5f15a89e14195aa5944f626a.jpg" alt=""></p>
<p>​    历史上，装配的方式是试用一个或多个XML文件。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">      http://www.springframework.org/schema/beans/spring-beans.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"knight"</span> <span class="attr">class</span>=<span class="string">"sia.knights.BraveKnight"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">ref</span>=<span class="string">"quest"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"quest"</span> <span class="attr">class</span>=<span class="string">"sia.knights.SlayDragonQuest"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">"#&#123;T(System).out&#125;"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>​    在最近的Spring版本中，基于Java的配置更为常见。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">KnightConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Knight <span class="title">knight</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> BraveKnight(quest());</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Quest <span class="title">quest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> SlayDragonQuest(System.out);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​    @Configuration注解会告知Spring这是一个配置类，会为Spring应用上下文提供Bean。</p>
<p>​    这个配置类的方法试用@Bean注解进行了编著，表明这些方法所返回的对象会以bean的形式添加到上下文中。</p>
<p>​    相对于XML的配置方式，基于Java的配置会带来多项额外收益，比如更强的类型安全性以及更好的重构能力。</p>
<p>不过不管是哪种方式，不能自动配置的时候才是重要的。</p>
<p>​    自动配置起源于自动装配(Autowiring)和组件扫描(component scanning)。扫描可以自动发现组件，创建成上下文中的Bean。又通过自动装配技术，注入到所依赖的其他bean中。</p>
<p>​    随着Spring Boot的引入，自动配置的能力大大增强，远超上面所述。最广为人知的增强方法就是自动配置(autoconfiguration)，Spring Boot能够基于类路径中的条目、环境变量和其他因素合理猜测需要配置的组件并将它们装配在一起。</p>
<h3 id="1-2-初始化Spring应用"><a href="#1-2-初始化Spring应用" class="headerlink" title="1.2 初始化Spring应用"></a>1.2 初始化Spring应用</h3><p>​    学会如何使用Spring Initializr初始化应用。</p>
<p>​    使用它的几个方式：</p>
<ul>
<li>通过地址<a href="https://start.spring.io/的Web应用；" target="_blank" rel="noopener">https://start.spring.io/的Web应用；</a></li>
<li>在命令行中使用curl命令；</li>
<li>在IntelliJ IDEA中创建新项目；</li>
<li>在NetBeans中创建新项目。</li>
</ul>
<p>作者展示的是在Spring Tool Suite中使用Spring Initializr。</p>
<p>我则使用IDEA创建项目。</p>
<h4 id="1-2-1-使用IDEA初始化Spring项目"><a href="#1-2-1-使用IDEA初始化Spring项目" class="headerlink" title="1.2.1 使用IDEA初始化Spring项目"></a>1.2.1 使用IDEA初始化Spring项目</h4><p>点击新建项目</p>
<p><img src="https://pic.imgdb.cn/item/5f15abb214195aa594508be5.jpg" alt=""></p>
<p>选择Spring Initializr</p>
<p><img src="https://pic.imgdb.cn/item/5f15abd014195aa594509eec.jpg" alt=""></p>
<p>填写Poject Metadata</p>
<p><img src="https://pic.imgdb.cn/item/5f15ac2a14195aa59450c684.jpg" alt=""></p>
<p>选择依赖，此处只勾选Lombok</p>
<p><img src="https://pic.imgdb.cn/item/5f15ac4614195aa59450d543.jpg" alt=""></p>
<p>如果必要，在这里可以选择Spring boot的版本</p>
<p><img src="https://pic.imgdb.cn/item/5f15ac7a14195aa59450ef8d.jpg" alt=""></p>
<p>最后一步，确认项目名字和存放地址。</p>
<p><img src="https://pic.imgdb.cn/item/5f15ac9714195aa59450fb91.jpg" alt=""></p>
<h4 id="1-2-2-确认Spring项目结果"><a href="#1-2-2-确认Spring项目结果" class="headerlink" title="1.2.2 确认Spring项目结果"></a>1.2.2 确认Spring项目结果</h4><p>目录如下</p>
<p><img src="https://pic.imgdb.cn/item/5f15acc514195aa594510c4f.jpg" alt=""></p>
<p>应用代码放在了src/main/java中</p>
<p>测试代码放在了src/test/java中</p>
<p>非Java的资源放在了src/main/resources中</p>
<p>注意几点</p>
<ul>
<li>mvnw和mvnw.cmd：这是Maven包装器脚本，借助这些脚本即使你的机器上没有安装Maven也可以构建构建项目。</li>
<li>pom.xml：这是Maven构建规范，随后会深入介绍该文件</li>
<li>SiaApplication：这是主类，它会启动该项目。</li>
<li>applicatin.properties:这个文件起初是空的，提供给我们指定配置属性的地方。详细在第5章</li>
<li>static&amp;templates: 与作者不同我这里没有这两个文件夹，是用来存放静态内容和Thymleaf模板的。</li>
<li>SiaApplicationTests：简单测试类，保证上下文可以成功加载。</li>
</ul>
<h5 id="探索构建规范"><a href="#探索构建规范" class="headerlink" title="探索构建规范"></a>探索构建规范</h5><p>pom.xml如下</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.1.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.sorie<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>sia<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>sia<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>Spring in action Study Source Code<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">	//默认打包为jar</span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.junit.vintage<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit-vintage-engine<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>​    应用构建默认会构建为jar文件。可能觉得有点奇怪。打包成jar文件是基于云思维做出的选择。因为不是所有的云平台都可以运行war。</p>
<p>​    第2章会详细谅解如何构建war文件。</p>
<p>​    在依赖中注意starter这个单词，Spring Boot starter依赖的特别之处在于它们本身并不包含库代码，而是传递性地拉取其他的库。</p>
<p>​    有三个好处：</p>
<ul>
<li>构建文件显著减小并更易于管理</li>
<li>可以更具它们所提供的功能来思考依赖而不是库文件名称。</li>
<li>不必担心版本问题，只需要关心使用的哪个版本的Spring Boot就可以了。</li>
</ul>
<p>​    最后，构建规范害包含了一个Spring Boot插件。提供了重要功能。</p>
<ul>
<li>提供了一个Maven goal，允许我们使用maven来允许引用</li>
<li>确保所有库都包含在可执行的jar文件中</li>
<li>在jar中生成一个manifest文件，将引导类生命为可执行jar的主类</li>
</ul>
<p>​    打开主类看一下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SiaApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(SiaApplication<span class="class">.<span class="keyword">class</span>, <span class="title">args</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​    只有很少代码</p>
<p>​    @SpringBootApplication是一个组合注解，组合了3个注解。</p>
<ul>
<li>@SpringBootConfiguration：将该类声明为配置类。其实上是@Configuration注解的特殊形式。</li>
<li>@EnableAutoConfiguration：启用Spring Boot的自动配置。自动配置我们会用到的组件</li>
<li>@ComponentScan：启用组件扫描。发现@Component，@Controller，@Service这样的组件。</li>
</ul>
<p>​    还有一个比较重要的地方是main方法，调用了SpringApplication的run方法。后者会真正执行应用的引导过程，就是创建Spring应用上下文。参数一个是配置类，另一个是命令行参数。</p>
<h5 id="测试应用"><a href="#测试应用" class="headerlink" title="测试应用"></a>测试应用</h5><p>打开测试类，修改代码如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringRunner;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith</span>(SpringRunner<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">@<span class="title">SpringBootTest</span></span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">SiaApplicationTests</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">contextLoads</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​    @SpringBootTest会告诉Junit在启动测试的时候要加上Spring Boot的功能。</p>
<p>​    SpringRunner是SpringJUnit4ClassRunner的别名。在Spring 4.3中引入，一面溢出对特定JUnit版本的关联。</p>
<p>​    这个代码就是测试是否可以成功启动Spring应用上下文。</p>
<p>​    下面开始添加一些自定义的代码。</p>
<h3 id="1-3-编写Spring应用"><a href="#1-3-编写Spring应用" class="headerlink" title="1.3 编写Spring应用"></a>1.3 编写Spring应用</h3><p>​    添加一个主页</p>
<ul>
<li>一个控制器类，用来处理主页相关的请求；</li>
<li>一个视图模板，用来定义主页看起来是什么样子</li>
</ul>
<p>​    还会有一个测试类</p>
<h4 id="1-3-1-处理Web请求"><a href="#1-3-1-处理Web请求" class="headerlink" title="1.3.1 处理Web请求"></a>1.3.1 处理Web请求</h4><p>​    Spring自带一个强大的Web框架，名为Spring MVC。核心是控制器理念。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span>            <span class="comment">// &lt;1&gt;</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HomeController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@GetMapping</span>(<span class="string">"/"</span>)     <span class="comment">// &lt;2&gt;</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">home</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"home"</span>;     <span class="comment">// &lt;3&gt;</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​    @Controller没有做额外的事情，主要目的是让组件扫描将这个类识别为一个组件。</p>
<p>​    实际上@Controller，@Component,@Service,@Repository等作用都是完全相同的，但是语义不同。</p>
<h4 id="1-3-2-定义视图"><a href="#1-3-2-定义视图" class="headerlink" title="1.3.2 定义视图"></a>1.3.2 定义视图</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns</span>=<span class="string">"http://www.w3.org/1999/xhtml"</span> </span></span><br><span class="line"><span class="tag">      <span class="attr">xmlns:th</span>=<span class="string">"http://www.thymeleaf.org"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Taco Cloud<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Welcome to...<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">th:src</span>=<span class="string">"@&#123;/images/TacoCloud.png&#125;"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="1-3-3-测试控制器"><a href="#1-3-3-测试控制器" class="headerlink" title="1.3.3 测试控制器"></a>1.3.3 测试控制器</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith</span>(SpringRunner<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">@<span class="title">WebMvcTest</span>(<span class="title">HomeController</span>.<span class="title">class</span>)   // &lt;1&gt;</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">HomeControllerTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Autowired</span></span><br><span class="line">  <span class="keyword">private</span> MockMvc mockMvc;   <span class="comment">// &lt;2&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testHomePage</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    mockMvc.perform(get(<span class="string">"/"</span>))    <span class="comment">// &lt;3&gt;</span></span><br><span class="line">    </span><br><span class="line">      .andExpect(status().isOk())  <span class="comment">// &lt;4&gt;</span></span><br><span class="line">      </span><br><span class="line">      .andExpect(view().name(<span class="string">"home"</span>))  <span class="comment">// &lt;5&gt;</span></span><br><span class="line">      </span><br><span class="line">      .andExpect(content().string(           <span class="comment">// &lt;6&gt;</span></span><br><span class="line">          containsString(<span class="string">"Welcome to..."</span>)));  </span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="1-3-4-构建与运行应用"><a href="#1-3-4-构建与运行应用" class="headerlink" title="1.3.4 构建与运行应用"></a>1.3.4 构建与运行应用</h4><p>​    如何启动略。</p>
<p>​    Spring Boot应用的习惯做法是将所有它需要的东西都放到一起，没有必要将其部署到某种应用服务器中。Tomcat是应用的一部分。</p>
<p>​    接下来快速浏览一下DevTools的特性。</p>
<h4 id="1-3-5-了解Spring-Boot-DevTools"><a href="#1-3-5-了解Spring-Boot-DevTools" class="headerlink" title="1.3.5 了解Spring Boot DevTools"></a>1.3.5 了解Spring Boot DevTools</h4><ul>
<li>代码变更后应用会自动重启；</li>
<li>当前面向浏览器的资源发生变化，会自动刷新浏览器；</li>
<li>自动禁用模板缓存</li>
<li>如果使用了H2数据库的话，内置了H2控制台。</li>
</ul>
<p>​    因为仅用于开发，可以很智能地在生产环境中把自己禁用掉。</p>
<h5 id="应用自动重启"><a href="#应用自动重启" class="headerlink" title="应用自动重启"></a>应用自动重启</h5><p>​    Devtools会监控变更，有变化会自动重启应用。</p>
<p>​    更准确的是，它运行的时候，程序被加载到JVM两个独立的类加载器中。其中一个加载Java代码、属性文件和main路径下几乎所有内容。另外一个加载器加载依赖的库。</p>
<p>​    检测到变更时，只会重新加载包含项目代码的类加载器，减少应用启动时间。</p>
<p>​    缺点是自动重启无法反应依赖项的变化，变更依赖无法让变更生效。</p>
<h5 id="浏览器自动刷新和禁用模板缓存"><a href="#浏览器自动刷新和禁用模板缓存" class="headerlink" title="浏览器自动刷新和禁用模板缓存"></a>浏览器自动刷新和禁用模板缓存</h5><p>​    默认情况下Thymeleaf和FreeMarker这样的模板方案会缓存解析结果。生产环境比较好，但是开发环境不太友好。</p>
<p>​    所以禁用后刷新一下就可以看到结果，但是刷新都懒得点时，DevTools可以提供一些功能。</p>
<p>​    它会自动启动一个LiveReload服务器，它与LiveReload浏览器插件结合起来，可以在静态文件发生变化时，自动刷新浏览器。</p>
<h5 id="内置H2控制台"><a href="#内置H2控制台" class="headerlink" title="内置H2控制台"></a>内置H2控制台</h5><p>​    如果使用H2数据库进行开发，DevTools会自动启动H2控制台。</p>
<h4 id="1-3-6-回顾一下"><a href="#1-3-6-回顾一下" class="headerlink" title="1.3.6 回顾一下"></a>1.3.6 回顾一下</h4><ul>
<li>使用Spring Initializr创建初始化项目结构</li>
<li>编写控制器处理针对主页的请求；</li>
<li>定义一个视图模板来渲染主页；</li>
<li>编写了一个测试类来验证工作符合预期。</li>
</ul>
<p>​    早pom文件中声明对Web和Thymeleaf starter的依赖。这两个依赖会传递引入大量其他依赖，包括：</p>
<ul>
<li>Spring MVC框架</li>
<li>嵌入式的Tomcat</li>
<li>Thymeleaf和Thymeleaf布局语言；</li>
</ul>
<p>​    还引入了Spring Boot的自动配置库。自动配置会探测到这些苦，完成如下功能。</p>
<ul>
<li>在上下文中配置bean以启动Spring MVC</li>
<li>在上下文中配置嵌入式的tomcat服务器；</li>
<li>配置Thymeleaf视图解析器，以便于使用Thymeleaf模板渲染Spring MVC视图。</li>
</ul>
<h3 id="1-4-俯瞰Spring风景线"><a href="#1-4-俯瞰Spring风景线" class="headerlink" title="1.4 俯瞰Spring风景线"></a>1.4 俯瞰Spring风景线</h3><p>​    想了解整体情况，只需要查看 Initializr表单的一堆复选框列表即可，有100多个可选的依赖项。</p>
<h4 id="1-4-1-Spring-核心框架"><a href="#1-4-1-Spring-核心框架" class="headerlink" title="1.4.1 Spring 核心框架"></a>1.4.1 Spring 核心框架</h4><p>​    Spring核心框架是Spring中一切基础。它提供了核心容器和依赖注入框架，还提供了一些其他重要的特性。</p>
<p>​    比如可以创建REST API，数据持久化的基础支持。</p>
<p>​    最新的Spring版本还添加了反应式风格变成的支持。</p>
<h4 id="1-4-2-Spring-Boot"><a href="#1-4-2-Spring-Boot" class="headerlink" title="1.4.2 Spring Boot"></a>1.4.2 Spring Boot</h4><p>​    除了starter依赖和自动配置还提供了大量其他有用的特性：</p>
<pre><code>* Actuator能够洞察应用运行时的内部工作状态，包括指标、线程dump信息、应用监控状况以及应用可用的环境属性；
* 灵活的环节属性规范；
* 在核心框架的测试辅助功能上提供了对测试的额外支持。</code></pre><p>​    除此之外，还提供了基于Groovy脚本的编程模型，称为Spring Boot命令行接口(Command-Line Interface, CLI)。</p>
<h4 id="1-4-3-Spring-data"><a href="#1-4-3-Spring-data" class="headerlink" title="1.4.3 Spring data"></a>1.4.3 Spring data</h4><p>​    它提供了非常令人惊叹的功能：将repository定义为非常简单的Java接口，在定义驱动存储和检索数据的方法是使用一种命名约定即可。</p>
<p>​    可以处理多种不同类型数据库：关系型数据库(JPA),文档数据库(mongo),图数据库(Noe4j)等。</p>
<h4 id="1-4-4-Spring-Security"><a href="#1-4-4-Spring-Security" class="headerlink" title="1.4.4 Spring Security"></a>1.4.4 Spring Security</h4><p>​    安全框架：</p>
<pre><code>* 身份验证；
* 授权；
* API安全性。</code></pre><p>​    范围太大，这本书无法深入。</p>
<h4 id="1-4-5-Spring-Integration和Spring-Batch"><a href="#1-4-5-Spring-Integration和Spring-Batch" class="headerlink" title="1.4.5 Spring Integration和Spring Batch"></a>1.4.5 Spring Integration和Spring Batch</h4><p>​    Spring Integration解决实时集成问题，Spring Batch解决批量集成问题。</p>
<h4 id="1-4-6-Spring-Cloud"><a href="#1-4-6-Spring-Cloud" class="headerlink" title="1.4.6 Spring Cloud"></a>1.4.6 Spring Cloud</h4><p>​    微服务。</p>
<p>​    建议阅读《Spring Microservices in Action》一书。</p>
<h3 id="1-5-小结"><a href="#1-5-小结" class="headerlink" title="1.5 小结"></a>1.5 小结</h3><ul>
<li>Spring旨在简化开发</li>
<li>Spring Boot 构建在Spring之上，通过简化依赖管理、自动配置和运行时洞察，使Spring更加易懂</li>
<li>Spring应用程序可以使用Spring Initializr进行初始化。</li>
<li>Spring上下文中，组件可以使用Java或XML显示生命，也可以通过组件扫描发现。</li>
</ul>
<h2 id="第2章-开发Web应用"><a href="#第2章-开发Web应用" class="headerlink" title="第2章 开发Web应用"></a>第2章 开发Web应用</h2><p>本章内容：</p>
<ul>
<li>浏览器中展示模型数据</li>
<li>处理和校验表单输入</li>
<li>选择视图模板库</li>
</ul>
<h3 id="2-1-展现信息"><a href="#2-1-展现信息" class="headerlink" title="2.1 展现信息"></a>2.1 展现信息</h3><p>​    在Spring Web中，获取和处理数据是控制器的任务，将数据渲染到HTML展示时视图的任务。</p>
<p>​    需要构建如下组件：</p>
<ul>
<li>用来定义taco配料属性的领域类。</li>
<li>用来获取配料信息并将其床底至视图的SpringMVC控制类。</li>
<li>用来在用户的浏览器中配置配料列表的视图模板</li>
</ul>
<p><img src="https://pic.imgdb.cn/item/5f16effd14195aa594e58acc.jpg" alt=""></p>
<p>​    本章只关注Spring的Web框架，数据库在第3张讲解。</p>
<h4 id="2-1-1-构建领域类"><a href="#2-1-1-构建领域类" class="headerlink" title="2.1.1 构建领域类"></a>2.1.1 构建领域类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Ingredient</span> </span>&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> String id;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> String name;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> Type type;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">enum</span> Type &#123;</span><br><span class="line">    WRAP, PROTEIN, VEGGIES, CHEESE, SAUCE</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​    使用了Lombok，不需要自定义getter, setter, equals(), hashCode(), toString()等方法。</p>
<p>添加依赖即可，idea也要添加lombok插件。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- &lt;scope&gt;compileOnly&lt;/scope&gt; --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="2-1-2-创建控制器类"><a href="#2-1-2-创建控制器类" class="headerlink" title="2.1.2 创建控制器类"></a>2.1.2 创建控制器类</h4><ul>
<li>处理路径为”/design”的HTTP GET请求</li>
<li>构建配料的列表</li>
<li>处理请求，并将配料数据传递给要渲染为HTML的视图模板，发送给发起请求的Web浏览器。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/design"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DesignTacoController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//end::head[]</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@ModelAttribute</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addIngredientsToModel</span><span class="params">(Model model)</span> </span>&#123;</span><br><span class="line">        List&lt;Ingredient&gt; ingredients = Arrays.asList(</span><br><span class="line">                <span class="keyword">new</span> Ingredient(<span class="string">"FLTO"</span>, <span class="string">"Flour Tortilla"</span>, Ingredient.Type.WRAP),</span><br><span class="line">                <span class="keyword">new</span> Ingredient(<span class="string">"COTO"</span>, <span class="string">"Corn Tortilla"</span>, Ingredient.Type.WRAP),</span><br><span class="line">                <span class="keyword">new</span> Ingredient(<span class="string">"GRBF"</span>, <span class="string">"Ground Beef"</span>, Ingredient.Type.PROTEIN),</span><br><span class="line">                <span class="keyword">new</span> Ingredient(<span class="string">"CARN"</span>, <span class="string">"Carnitas"</span>, Ingredient.Type.PROTEIN),</span><br><span class="line">                <span class="keyword">new</span> Ingredient(<span class="string">"TMTO"</span>, <span class="string">"Diced Tomatoes"</span>, Ingredient.Type.VEGGIES),</span><br><span class="line">                <span class="keyword">new</span> Ingredient(<span class="string">"LETC"</span>, <span class="string">"Lettuce"</span>, Ingredient.Type.VEGGIES),</span><br><span class="line">                <span class="keyword">new</span> Ingredient(<span class="string">"CHED"</span>, <span class="string">"Cheddar"</span>, Ingredient.Type.CHEESE),</span><br><span class="line">                <span class="keyword">new</span> Ingredient(<span class="string">"JACK"</span>, <span class="string">"Monterrey Jack"</span>, Ingredient.Type.CHEESE),</span><br><span class="line">                <span class="keyword">new</span> Ingredient(<span class="string">"SLSA"</span>, <span class="string">"Salsa"</span>, Ingredient.Type.SAUCE),</span><br><span class="line">                <span class="keyword">new</span> Ingredient(<span class="string">"SRCR"</span>, <span class="string">"Sour Cream"</span>, Ingredient.Type.SAUCE)</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        Ingredient.Type[] types = Ingredient.Type.values();</span><br><span class="line">        <span class="keyword">for</span> (Ingredient.Type type : types) &#123;</span><br><span class="line">            model.addAttribute(type.toString().toLowerCase(),</span><br><span class="line">                    filterByType(ingredients, type));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//tag::showDesignForm[]</span></span><br><span class="line">    <span class="meta">@GetMapping</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">showDesignForm</span><span class="params">(Model model)</span> </span>&#123;</span><br><span class="line">        model.addAttribute(<span class="string">"design"</span>, <span class="keyword">new</span> Taco());</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"design"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//end::showDesignForm[]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">//tag::processDesign[]</span></span><br><span class="line"><span class="comment">  @PostMapping</span></span><br><span class="line"><span class="comment">  public String processDesign(Design design) &#123;</span></span><br><span class="line"><span class="comment">    // Save the taco design...</span></span><br><span class="line"><span class="comment">    // We'll do this in chapter 3</span></span><br><span class="line"><span class="comment">    log.info("Processing design: " + design);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    return "redirect:/orders/current";</span></span><br><span class="line"><span class="comment">  &#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">//end::processDesign[]</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//tag::processDesignValidated[]</span></span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">processDesign</span><span class="params">(@Valid @ModelAttribute(<span class="string">"design"</span>)</span> Taco design, Errors errors, Model model) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (errors.hasErrors()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"design"</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Save the taco design...</span></span><br><span class="line">        <span class="comment">// We'll do this in chapter 3</span></span><br><span class="line">        log.info(<span class="string">"Processing design: "</span> + design);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"redirect:/orders/current"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//end::processDesignValidated[]</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//tag::filterByType[]</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> List&lt;Ingredient&gt; <span class="title">filterByType</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">            List&lt;Ingredient&gt; ingredients, Ingredient.Type type)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ingredients</span><br><span class="line">                .stream()</span><br><span class="line">                .filter(x -&gt; x.getType().equals(type))</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//end::filterByType[]</span></span><br><span class="line"><span class="comment">// tag::foot[]</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// end::foot[]</span></span><br></pre></td></tr></table></figure>

<p>​    注意注解。首先是@Slf4j，是Lombok提供的注解，会在类自动生成一个SLF4J的Logger和下面代码效果一样</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> org.slf4j.Logger log = org.slf4j.LoggerFactory.getLogger(DesignTacoController<span class="class">.<span class="keyword">class</span>)</span>;</span><br></pre></td></tr></table></figure>

<p>​    然后是@Controller，用于识别这个类是控制器。Spring会发现它并自动创建一个DesignTacoController实例，并将该实例作为Spring应用上下文中的bean。</p>
<p>​    还有@RequestMapping注解。可以指定该控制器处理的请求类型。在该例中处理类型都是以”/design”开头的请求。</p>
<h5 id="处理GET请求"><a href="#处理GET请求" class="headerlink" title="处理GET请求"></a>处理GET请求</h5><p>​    修饰showDesignForm方法的@GetMapping注解对类级别的@RequestMapping进行了细化。</p>
<p>​    @GetMapping是一个比较新的注解，在Spring4.3引入，效果类似于</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(</span><br><span class="line">    method = &#123;RequestMethod.GET&#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>​    显然@GetMapping更加简洁。</p>
<p><img src="https://pic.imgdb.cn/item/5f16f4f214195aa594e801e3.jpg" alt=""></p>
<blockquote>
<p><strong>让正确的事情变更更容易</strong></p>
<p>@RequestMapping(method = {RequestMethod.GET})让开发人员容易懒惰地忽略掉method属性。</p>
<p>作者喜欢在类级别上使用@RequestMapping，具体的方法上使用@GetMapping、@PostMapping等。</p>
</blockquote>
<h4 id="2-1-3-设计视图"><a href="#2-1-3-设计视图" class="headerlink" title="2.1.3 设计视图"></a>2.1.3 设计视图</h4><p>​    使用ThymeLeaf</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>​    在运行时，Spring Boot的自动配置功能会发现ThymeLeaf在类路径中，因此会为Spring MVC创建支撑ThymeLeaf视图的bean。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">"$&#123;ingredient.name&#125;"</span>&gt;</span>INGREDIENT<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>th:text是Thymeleaf命名空间中的属性，它会执行替换过程,${}会告诉它要使用某个请求属性。</p>
<p>​    不做过多介绍。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- tag::all[] --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- tag::head[] --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns</span>=<span class="string">"http://www.w3.org/1999/xhtml"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">xmlns:th</span>=<span class="string">"http://www.thymeleaf.org"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Taco Cloud<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">th:href</span>=<span class="string">"@&#123;/styles.css&#125;"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Design your taco!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">th:src</span>=<span class="string">"@&#123;/images/TacoCloud.png&#125;"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- tag::formTag[] --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">"POST"</span> <span class="attr">th:object</span>=<span class="string">"$&#123;design&#125;"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- end::all[] --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"validationError"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">th:if</span>=<span class="string">"$&#123;#fields.hasErrors('ingredients')&#125;"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">th:errors</span>=<span class="string">"*&#123;ingredients&#125;"</span>&gt;</span>Ingredient Error<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- tag::all[] --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"grid"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- end::formTag[] --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- end::head[] --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"ingredient-group"</span> <span class="attr">id</span>=<span class="string">"wraps"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- tag::designateWrap[] --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">h3</span>&gt;</span>Designate your wrap:<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">th:each</span>=<span class="string">"ingredient : $&#123;wrap&#125;"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"ingredients"</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">th:value</span>=<span class="string">"$&#123;ingredient.id&#125;"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">"$&#123;ingredient.name&#125;"</span>&gt;</span>INGREDIENT<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- end::designateWrap[] --&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">     <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"ingredient-group"</span> <span class="attr">id</span>=<span class="string">"proteins"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">h3</span>&gt;</span>Pick your protein:<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">th:each</span>=<span class="string">"ingredient : $&#123;protein&#125;"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"ingredients"</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">th:value</span>=<span class="string">"$&#123;ingredient.id&#125;"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">"$&#123;ingredient.name&#125;"</span>&gt;</span>INGREDIENT<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">     <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"ingredient-group"</span> <span class="attr">id</span>=<span class="string">"cheeses"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">h3</span>&gt;</span>Choose your cheese:<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">th:each</span>=<span class="string">"ingredient : $&#123;cheese&#125;"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"ingredients"</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">th:value</span>=<span class="string">"$&#123;ingredient.id&#125;"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">"$&#123;ingredient.name&#125;"</span>&gt;</span>INGREDIENT<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">     <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"ingredient-group"</span> <span class="attr">id</span>=<span class="string">"veggies"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">h3</span>&gt;</span>Determine your veggies:<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">th:each</span>=<span class="string">"ingredient : $&#123;veggies&#125;"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"ingredients"</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">th:value</span>=<span class="string">"$&#123;ingredient.id&#125;"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">"$&#123;ingredient.name&#125;"</span>&gt;</span>INGREDIENT<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">     <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"ingredient-group"</span> <span class="attr">id</span>=<span class="string">"sauces"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">h3</span>&gt;</span>Select your sauce:<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">th:each</span>=<span class="string">"ingredient : $&#123;sauce&#125;"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"ingredients"</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">th:value</span>=<span class="string">"$&#123;ingredient.id&#125;"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">"$&#123;ingredient.name&#125;"</span>&gt;</span>INGREDIENT<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">h3</span>&gt;</span>Name your taco creation:<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">th:field</span>=<span class="string">"*&#123;name&#125;"</span>/&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- end::all[] --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">"$&#123;#fields.hasErrors('name')&#125;"</span>&gt;</span>XXX<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"validationError"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">th:if</span>=<span class="string">"$&#123;#fields.hasErrors('name')&#125;"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">th:errors</span>=<span class="string">"*&#123;name&#125;"</span>&gt;</span>Name Error<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- tag::all[] --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span>&gt;</span>Submit your taco<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- tag::closeFormTag[] --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- end::closeFormTag[] --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- end::all[] --&gt;</span></span><br></pre></td></tr></table></figure>

<p>效果如下：</p>
<p><img src="https://pic.imgdb.cn/item/5f16f7a514195aa594e8e427.jpg" alt=""></p>
<h3 id="2-2-处理表单提交"><a href="#2-2-处理表单提交" class="headerlink" title="2.2 处理表单提交"></a>2.2 处理表单提交</h3><p>​    form标签method被设置为POST。意味着在提交的时候会调用”/design”的POST方法，把所有表单中的数据发送到服务端。</p>
<p>​    有一个POST方法来处理请求</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">processDesign</span><span class="params">(@Valid @ModelAttribute(<span class="string">"design"</span>)</span> Taco design, Errors errors, Model model) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (errors.hasErrors()) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"design"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Save the taco design...</span></span><br><span class="line">    <span class="comment">// We'll do this in chapter 3</span></span><br><span class="line">    log.info(<span class="string">"Processing design: "</span> + design);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">"redirect:/orders/current"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当表单提交时，输入会绑定到Taco对象上。</p>
<p>然后创建一个OrderController来将taco快递过去</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/orders"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderController</span> </span>&#123;</span><br><span class="line">  </span><br><span class="line"><span class="comment">//end::baseClass[]</span></span><br><span class="line"><span class="comment">//tag::orderForm[]</span></span><br><span class="line">  <span class="meta">@GetMapping</span>(<span class="string">"/current"</span>)</span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">orderForm</span><span class="params">(Model model)</span> </span>&#123;</span><br><span class="line">    model.addAttribute(<span class="string">"order"</span>, <span class="keyword">new</span> Order());</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"orderForm"</span>;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">//end::orderForm[]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">//tag::handlePost[]</span></span><br><span class="line"><span class="comment">  @PostMapping</span></span><br><span class="line"><span class="comment">  public String processOrder(Order order) &#123;</span></span><br><span class="line"><span class="comment">    log.info("Order submitted: " + order);</span></span><br><span class="line"><span class="comment">    return "redirect:/";</span></span><br><span class="line"><span class="comment">  &#125;</span></span><br><span class="line"><span class="comment">//end::handlePost[]</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">  </span><br><span class="line"><span class="comment">//tag::handlePostWithValidation[]</span></span><br><span class="line">  <span class="meta">@PostMapping</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">processOrder</span><span class="params">(@Valid Order order, Errors errors)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (errors.hasErrors()) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">"orderForm"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    log.info(<span class="string">"Order submitted: "</span> + order);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"redirect:/"</span>;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">//end::handlePostWithValidation[]</span></span><br><span class="line">  </span><br><span class="line"><span class="comment">//tag::baseClass[]</span></span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//end::baseClass[]</span></span><br></pre></td></tr></table></figure>

<p>视图为</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- tag::allButValidation[] --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns</span>=<span class="string">"http://www.w3.org/1999/xhtml"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">xmlns:th</span>=<span class="string">"http://www.thymeleaf.org"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Taco Cloud<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">th:href</span>=<span class="string">"@&#123;/styles.css&#125;"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">"POST"</span> <span class="attr">th:action</span>=<span class="string">"@&#123;/orders&#125;"</span> <span class="attr">th:object</span>=<span class="string">"$&#123;order&#125;"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Order your taco creations!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">img</span> <span class="attr">th:src</span>=<span class="string">"@&#123;/images/TacoCloud.png&#125;"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">"@&#123;/design&#125;"</span> <span class="attr">id</span>=<span class="string">"another"</span>&gt;</span>Design another taco<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">th:if</span>=<span class="string">"$&#123;#fields.hasErrors()&#125;"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"validationError"</span>&gt;</span></span><br><span class="line">        Please correct the problems below and resubmit.</span><br><span class="line">        <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">h3</span>&gt;</span>Deliver my taco masterpieces to...<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"name"</span>&gt;</span>Name: <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">th:field</span>=<span class="string">"*&#123;name&#125;"</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- end::allButValidation[] --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"validationError"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">th:if</span>=<span class="string">"$&#123;#fields.hasErrors('name')&#125;"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">th:errors</span>=<span class="string">"*&#123;name&#125;"</span>&gt;</span>Name Error<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- tag::allButValidation[] --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"street"</span>&gt;</span>Street address: <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">th:field</span>=<span class="string">"*&#123;street&#125;"</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- end::allButValidation[] --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"validationError"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">th:if</span>=<span class="string">"$&#123;#fields.hasErrors('street')&#125;"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">th:errors</span>=<span class="string">"*&#123;street&#125;"</span>&gt;</span>Street Error<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- tag::allButValidation[] --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"city"</span>&gt;</span>City: <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">th:field</span>=<span class="string">"*&#123;city&#125;"</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- end::allButValidation[] --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"validationError"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">th:if</span>=<span class="string">"$&#123;#fields.hasErrors('city')&#125;"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">th:errors</span>=<span class="string">"*&#123;city&#125;"</span>&gt;</span>City Error<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- tag::allButValidation[] --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"state"</span>&gt;</span>State: <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">th:field</span>=<span class="string">"*&#123;state&#125;"</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- end::allButValidation[] --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"validationError"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">th:if</span>=<span class="string">"$&#123;#fields.hasErrors('state')&#125;"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">th:errors</span>=<span class="string">"*&#123;state&#125;"</span>&gt;</span>State Error<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- tag::allButValidation[] --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"zip"</span>&gt;</span>Zip code: <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">th:field</span>=<span class="string">"*&#123;zip&#125;"</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- end::allButValidation[] --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"validationError"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">th:if</span>=<span class="string">"$&#123;#fields.hasErrors('zip')&#125;"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">th:errors</span>=<span class="string">"*&#123;zip&#125;"</span>&gt;</span>Zip Error<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- tag::allButValidation[] --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">h3</span>&gt;</span>Here's how I'll pay...<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- tag::validatedField[] --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"ccNumber"</span>&gt;</span>Credit Card #: <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">th:field</span>=<span class="string">"*&#123;ccNumber&#125;"</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- end::allButValidation[] --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"validationError"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">th:if</span>=<span class="string">"$&#123;#fields.hasErrors('ccNumber')&#125;"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">th:errors</span>=<span class="string">"*&#123;ccNumber&#125;"</span>&gt;</span>CC Num Error<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- tag::allButValidation[] --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- end::validatedField[] --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"ccExpiration"</span>&gt;</span>Expiration: <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">th:field</span>=<span class="string">"*&#123;ccExpiration&#125;"</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- end::allButValidation[] --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"validationError"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">th:if</span>=<span class="string">"$&#123;#fields.hasErrors('ccExpiration')&#125;"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">th:errors</span>=<span class="string">"*&#123;ccExpiration&#125;"</span>&gt;</span>CC Num Error<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- tag::allButValidation[] --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"ccCVV"</span>&gt;</span>CVV: <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">th:field</span>=<span class="string">"*&#123;ccCVV&#125;"</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- end::allButValidation[] --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"validationError"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">th:if</span>=<span class="string">"$&#123;#fields.hasErrors('ccCVV')&#125;"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">th:errors</span>=<span class="string">"*&#123;ccCVV&#125;"</span>&gt;</span>CC Num Error<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- tag::allButValidation[] --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"Submit order"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- end::allButValidation[] --&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="2-3-校验表单输入"><a href="#2-3-校验表单输入" class="headerlink" title="2.3 校验表单输入"></a>2.3 校验表单输入</h3><p>javax和hibernate的校验</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.validation.constraints.Digits;</span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.NotBlank;</span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.Pattern;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.hibernate.validator.constraints.CreditCardNumber;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Order</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//end::allButValidation[]</span></span><br><span class="line">  <span class="meta">@NotBlank</span>(message=<span class="string">"Name is required"</span>)</span><br><span class="line">  <span class="comment">//tag::allButValidation[]</span></span><br><span class="line">  <span class="keyword">private</span> String name;</span><br><span class="line">  <span class="comment">//end::allButValidation[]</span></span><br><span class="line"></span><br><span class="line">  <span class="meta">@NotBlank</span>(message=<span class="string">"Street is required"</span>)</span><br><span class="line">  <span class="comment">//tag::allButValidation[]</span></span><br><span class="line">  <span class="keyword">private</span> String street;</span><br><span class="line">  <span class="comment">//end::allButValidation[]</span></span><br><span class="line"></span><br><span class="line">  <span class="meta">@NotBlank</span>(message=<span class="string">"City is required"</span>)</span><br><span class="line">  <span class="comment">//tag::allButValidation[]</span></span><br><span class="line">  <span class="keyword">private</span> String city;</span><br><span class="line">  <span class="comment">//end::allButValidation[]</span></span><br><span class="line"></span><br><span class="line">  <span class="meta">@NotBlank</span>(message=<span class="string">"State is required"</span>)</span><br><span class="line">  <span class="comment">//tag::allButValidation[]</span></span><br><span class="line">  <span class="keyword">private</span> String state;</span><br><span class="line">  <span class="comment">//end::allButValidation[]</span></span><br><span class="line"></span><br><span class="line">  <span class="meta">@NotBlank</span>(message=<span class="string">"Zip code is required"</span>)</span><br><span class="line">  <span class="comment">//tag::allButValidation[]</span></span><br><span class="line">  <span class="keyword">private</span> String zip;</span><br><span class="line">  <span class="comment">//end::allButValidation[]</span></span><br><span class="line"></span><br><span class="line">  <span class="meta">@CreditCardNumber</span>(message=<span class="string">"Not a valid credit card number"</span>)</span><br><span class="line">  <span class="comment">//tag::allButValidation[]</span></span><br><span class="line">  <span class="keyword">private</span> String ccNumber;</span><br><span class="line">  <span class="comment">//end::allButValidation[]</span></span><br><span class="line"></span><br><span class="line">  <span class="meta">@Pattern</span>(regexp=<span class="string">"^(0[1-9]|1[0-2])([\\/])([1-9][0-9])$"</span>,</span><br><span class="line">           message=<span class="string">"Must be formatted MM/YY"</span>)</span><br><span class="line">  <span class="comment">//tag::allButValidation[]</span></span><br><span class="line">  <span class="keyword">private</span> String ccExpiration;</span><br><span class="line">  <span class="comment">//end::allButValidation[]</span></span><br><span class="line"></span><br><span class="line">  <span class="meta">@Digits</span>(integer=<span class="number">3</span>, fraction=<span class="number">0</span>, message=<span class="string">"Invalid CVV"</span>)</span><br><span class="line">  <span class="comment">//tag::allButValidation[]</span></span><br><span class="line">  <span class="keyword">private</span> String ccCVV;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//end::allButValidation[]</span></span><br><span class="line"><span class="comment">//end::all[]</span></span><br></pre></td></tr></table></figure>



<h4 id="2-3-1-声明校验规则"><a href="#2-3-1-声明校验规则" class="headerlink" title="2.3.1 声明校验规则"></a>2.3.1 声明校验规则</h4><p>略</p>
<h4 id="2-3-2-在表单绑定时执行校验"><a href="#2-3-2-在表单绑定时执行校验" class="headerlink" title="2.3.2 在表单绑定时执行校验"></a>2.3.2 在表单绑定时执行校验</h4><p>需要修改控制器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">processOrder</span><span class="params">(@Valid Order order, Errors errors)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (errors.hasErrors()) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"orderForm"</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  log.info(<span class="string">"Order submitted: "</span> + order);</span><br><span class="line">  <span class="keyword">return</span> <span class="string">"redirect:/"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>有错误就反馈到页面上</p>
<h4 id="2-3-3-展示校验错误"><a href="#2-3-3-展示校验错误" class="headerlink" title="2.3.3 展示校验错误"></a>2.3.3 展示校验错误</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;span <span class="class"><span class="keyword">class</span></span>=<span class="string">"validationError"</span></span><br><span class="line">      th:<span class="keyword">if</span>=<span class="string">"$&#123;#fields.hasErrors('street')&#125;"</span></span><br><span class="line">      th:errors="*&#123;street&#125;"&gt;Street Error&lt;/span&gt;</span><br></pre></td></tr></table></figure>

<h3 id="2-4-使用视图控制器"><a href="#2-4-使用视图控制器" class="headerlink" title="2.4 使用视图控制器"></a>2.4 使用视图控制器</h3><p>编写三个Controller</p>
<ul>
<li>都是用@Controller注解；</li>
<li>除了HomeController，其他Controller都是用了@RequestMapping注解；</li>
<li>都有一个或者多个带@GetMapping或@PostMapping注解的方法</li>
</ul>
<p>​    大部分控制器遵循这个标准。</p>
<p>​    如果一个控制器无需填充说明或处理输入，有另外方式可以定义控制器。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebConfig</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addViewControllers</span><span class="params">(ViewControllerRegistry registry)</span> </span>&#123;</span><br><span class="line">    registry.addViewController(<span class="string">"/"</span>).setViewName(<span class="string">"home"</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>也可以用主类去继承这个接口。</p>
<h3 id="2-5-选择视图模板"><a href="#2-5-选择视图模板" class="headerlink" title="2.5 选择视图模板"></a>2.5 选择视图模板</h3><p><img src="https://pic.imgdb.cn/item/5f1851b314195aa594804081.jpg" alt=""></p>
<p><img src="https://pic.imgdb.cn/item/5f1851c214195aa5948048d3.jpg" alt=""></p>
<h4 id="缓存模板"><a href="#缓存模板" class="headerlink" title="缓存模板"></a>缓存模板</h4><p>​    默认情况，模板只有在第一次使用的时候解析一次，解析结果会被后续请求所使用。开发不方便，可以禁用掉。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#application.properties</span></span><br><span class="line"><span class="meta">spring.thymeleaf.cache</span>=<span class="string">false</span></span><br></pre></td></tr></table></figure>

<p><img src="https://pic.imgdb.cn/item/5f18523214195aa5948098cf.jpg" alt=""></p>
<p>或者使用Spring DevTools，它的其中一个功能就是禁止模板缓存。</p>
<h3 id="2-6-小结"><a href="#2-6-小结" class="headerlink" title="2.6 小结"></a>2.6 小结</h3><ul>
<li>Spring MVC是一个强大的Web框架；</li>
<li>Spring MVC基于注解；</li>
<li>大多请求会返回一个视图的逻辑名称，请求会转发到这样的视图上；</li>
<li>Spring MVC支持校验，通过JavaBean ValidationAPI和Validation API实现(如Hibernate Validator)完成的；</li>
<li>对于没有模型数据和逻辑处理的HTTP GET请求，可以使用视图控制器处理；</li>
<li>除了Thymeleaf，Spring还支持各种视图方案。</li>
</ul>
<h2 id="第3章-使用数据"><a href="#第3章-使用数据" class="headerlink" title="第3章 使用数据"></a>第3章 使用数据</h2><p>本章内容：</p>
<ul>
<li>使用Spring的JdbcTempldate；</li>
<li>使用SimpleJdbcInsert插入数据；</li>
<li>使用Spring Data声明JPA repository。</li>
</ul>
<h3 id="3-1-使用JDBC读取和写入数据"><a href="#3-1-使用JDBC读取和写入数据" class="headerlink" title="3.1 使用JDBC读取和写入数据"></a>3.1 使用JDBC读取和写入数据</h3><p>​    在处理关系型数据时，有多种可选方案，最常见的是JDBC和JPA。Spring都支持两种的抽象形式，让使用更加容易。</p>
<p>​    对JDBC的支持归功于JDBCTempldate类。</p>
<p>​    普通使用JDBC很麻烦，代码这里就省去了。</p>
<p>​    如果是使用JDBCTemplate代码就如下</p>
<p><img src="https://pic.imgdb.cn/item/5f18576c14195aa59484f030.jpg" alt=""></p>
<h4 id="3-1-1-调整领域对象以适应持久化"><a href="#3-1-1-调整领域对象以适应持久化" class="headerlink" title="3.1.1 调整领域对象以适应持久化"></a>3.1.1 调整领域对象以适应持久化</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.RequiredArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Ingredient</span> </span>&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> String id;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> String name;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> Type type;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">enum</span> Type &#123;</span><br><span class="line">    WRAP, PROTEIN, VEGGIES, CHEESE, SAUCE</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Order</span> </span>&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">private</span> Long id;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">private</span> Date placedAt;</span><br><span class="line">  </span><br><span class="line"><span class="comment">//end::newFields[]</span></span><br><span class="line"></span><br><span class="line">  <span class="meta">@NotBlank</span>(message=<span class="string">"Delivery name is required"</span>)</span><br><span class="line">  <span class="keyword">private</span> String deliveryName;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@NotBlank</span>(message=<span class="string">"Street is required"</span>)</span><br><span class="line">  <span class="keyword">private</span> String deliveryStreet;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@NotBlank</span>(message=<span class="string">"City is required"</span>)</span><br><span class="line">  <span class="keyword">private</span> String deliveryCity;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@NotBlank</span>(message=<span class="string">"State is required"</span>)</span><br><span class="line">  <span class="keyword">private</span> String deliveryState;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@NotBlank</span>(message=<span class="string">"Zip code is required"</span>)</span><br><span class="line">  <span class="keyword">private</span> String deliveryZip;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@CreditCardNumber</span>(message=<span class="string">"Not a valid credit card number"</span>)</span><br><span class="line">  <span class="keyword">private</span> String ccNumber;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Pattern</span>(regexp=<span class="string">"^(0[1-9]|1[0-2])([\\/])([1-9][0-9])$"</span>,</span><br><span class="line">           message=<span class="string">"Must be formatted MM/YY"</span>)</span><br><span class="line">  <span class="keyword">private</span> String ccExpiration;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Digits</span>(integer=<span class="number">3</span>, fraction=<span class="number">0</span>, message=<span class="string">"Invalid CVV"</span>)</span><br><span class="line">  <span class="keyword">private</span> String ccCVV;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> List&lt;Taco&gt; tacos = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addDesign</span><span class="params">(Taco design)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.tacos.add(design);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">// tag::newFields[]</span></span><br><span class="line"><span class="comment">  ...</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">// end::newFields[]</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"><span class="comment">//tag::newFields[]</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//end::newFields[]</span></span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Taco</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> Long id;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">private</span> Date createdAt;</span><br><span class="line"></span><br><span class="line"><span class="comment">//end::newFields[]</span></span><br><span class="line"></span><br><span class="line">  <span class="meta">@NotNull</span></span><br><span class="line">  <span class="meta">@Size</span>(min=<span class="number">5</span>, message=<span class="string">"Name must be at least 5 characters long"</span>)</span><br><span class="line">  <span class="keyword">private</span> String name;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Size</span>(min=<span class="number">1</span>, message=<span class="string">"You must choose at least 1 ingredient"</span>)</span><br><span class="line">  <span class="keyword">private</span> List&lt;Ingredient&gt; ingredients;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">//tag::newFields[]</span></span><br><span class="line"><span class="comment">   ...</span></span><br><span class="line"><span class="comment">   </span></span><br><span class="line"><span class="comment">//end::newFields[]</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"><span class="comment">//tag::newFields[]</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//end::newFields[]</span></span><br></pre></td></tr></table></figure>

<h4 id="3-1-2-使用JdbcTempldate"><a href="#3-1-2-使用JdbcTempldate" class="headerlink" title="3.1.2 使用JdbcTempldate"></a>3.1.2 使用JdbcTempldate</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>嵌入式的数据库h2</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.h2database<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>h2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="定义JDBC-repository"><a href="#定义JDBC-repository" class="headerlink" title="定义JDBC repository"></a>定义JDBC repository</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IngredientRepository</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function">Iterable&lt;Ingredient&gt; <span class="title">findAll</span><span class="params">()</span></span>;</span><br><span class="line">  </span><br><span class="line">  <span class="function">Ingredient <span class="title">findById</span><span class="params">(String id)</span></span>;</span><br><span class="line">  </span><br><span class="line">  <span class="function">Ingredient <span class="title">save</span><span class="params">(Ingredient ingredient)</span></span>;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>用JDBC实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JdbcIngredientRepository</span></span></span><br><span class="line"><span class="class">    <span class="keyword">implements</span> <span class="title">IngredientRepository</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//tag::jdbcTemplate[]</span></span><br><span class="line">  <span class="keyword">private</span> JdbcTemplate jdbc;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//end::jdbcTemplate[]</span></span><br><span class="line"></span><br><span class="line">  <span class="meta">@Autowired</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">JdbcIngredientRepository</span><span class="params">(JdbcTemplate jdbc)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.jdbc = jdbc;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">//end::classShell[]</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//tag::finders[]</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Iterable&lt;Ingredient&gt; <span class="title">findAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> jdbc.query(<span class="string">"select id, name, type from Ingredient"</span>,</span><br><span class="line">        <span class="keyword">this</span>::mapRowToIngredient);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// tag::findOne[]</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Ingredient <span class="title">findById</span><span class="params">(String id)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> jdbc.queryForObject(</span><br><span class="line">        <span class="string">"select id, name, type from Ingredient where id=?"</span>,</span><br><span class="line">        <span class="keyword">this</span>::mapRowToIngredient, id);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// end::findOne[]</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">//end::finders[]</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">  //tag::preJava8RowMapper[]</span></span><br><span class="line"><span class="comment">  @Override</span></span><br><span class="line"><span class="comment">  public Ingredient findOne(String id) &#123;</span></span><br><span class="line"><span class="comment">    return jdbc.queryForObject(</span></span><br><span class="line"><span class="comment">        "select id, name, type from Ingredient where id=?",</span></span><br><span class="line"><span class="comment">        new RowMapper&lt;Ingredient&gt;() &#123;</span></span><br><span class="line"><span class="comment">          public Ingredient mapRow(ResultSet rs, int rowNum) </span></span><br><span class="line"><span class="comment">              throws SQLException &#123;</span></span><br><span class="line"><span class="comment">            return new Ingredient(</span></span><br><span class="line"><span class="comment">                rs.getString("id"), </span></span><br><span class="line"><span class="comment">                rs.getString("name"),</span></span><br><span class="line"><span class="comment">                Ingredient.Type.valueOf(rs.getString("type")));</span></span><br><span class="line"><span class="comment">          &#125;;</span></span><br><span class="line"><span class="comment">        &#125;, id);</span></span><br><span class="line"><span class="comment">  &#125;</span></span><br><span class="line"><span class="comment">  //end::preJava8RowMapper[]</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">//tag::save[]</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Ingredient <span class="title">save</span><span class="params">(Ingredient ingredient)</span> </span>&#123;</span><br><span class="line">    jdbc.update(</span><br><span class="line">        <span class="string">"insert into Ingredient (id, name, type) values (?, ?, ?)"</span>,</span><br><span class="line">        ingredient.getId(), </span><br><span class="line">        ingredient.getName(),</span><br><span class="line">        ingredient.getType().toString());</span><br><span class="line">    <span class="keyword">return</span> ingredient;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//end::save[]</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// tag::findOne[]</span></span><br><span class="line">  <span class="comment">//tag::finders[]</span></span><br><span class="line">  <span class="function"><span class="keyword">private</span> Ingredient <span class="title">mapRowToIngredient</span><span class="params">(ResultSet rs, <span class="keyword">int</span> rowNum)</span></span></span><br><span class="line"><span class="function">      <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Ingredient(</span><br><span class="line">        rs.getString(<span class="string">"id"</span>), </span><br><span class="line">        rs.getString(<span class="string">"name"</span>),</span><br><span class="line">        Ingredient.Type.valueOf(rs.getString(<span class="string">"type"</span>)));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//end::finders[]</span></span><br><span class="line">  <span class="comment">// end::findOne[]</span></span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">//tag::classShell[]</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">  ...</span></span><br><span class="line"><span class="comment">//end::classShell[]</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"><span class="comment">//tag::classShell[]</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//end::classShell[]</span></span><br></pre></td></tr></table></figure>

<h5 id="插入一行数据"><a href="#插入一行数据" class="headerlink" title="插入一行数据"></a>插入一行数据</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Ingredient <span class="title">save</span><span class="params">(Ingredient ingredient)</span> </span>&#123;</span><br><span class="line">  jdbc.update(</span><br><span class="line">      <span class="string">"insert into Ingredient (id, name, type) values (?, ?, ?)"</span>,</span><br><span class="line">      ingredient.getId(), </span><br><span class="line">      ingredient.getName(),</span><br><span class="line">      ingredient.getType().toString());</span><br><span class="line">  <span class="keyword">return</span> ingredient;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>将其运用到Controller中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/design"</span>)</span><br><span class="line"><span class="meta">@SessionAttributes</span>(<span class="string">"order"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DesignTacoController</span> </span>&#123;</span><br><span class="line">  </span><br><span class="line"><span class="comment">//end::classShell[]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//tag::bothRepoProperties[]</span></span><br><span class="line"><span class="comment">//tag::ingredientRepoProperty[]</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> IngredientRepository ingredientRepo;</span><br><span class="line">  </span><br><span class="line"><span class="comment">//end::ingredientRepoProperty[]</span></span><br><span class="line">  <span class="keyword">private</span> TacoRepository designRepo;</span><br><span class="line"></span><br><span class="line"><span class="comment">//end::bothRepoProperties[]</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">// tag::ingredientRepoOnlyCtor[]</span></span><br><span class="line"><span class="comment">  @Autowired</span></span><br><span class="line"><span class="comment">  public DesignTacoController(IngredientRepository ingredientRepo) &#123;</span></span><br><span class="line"><span class="comment">    this.ingredientRepo = ingredientRepo;</span></span><br><span class="line"><span class="comment">  &#125;</span></span><br><span class="line"><span class="comment">// end::ingredientRepoOnlyCtor[]</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//tag::bothRepoCtor[]</span></span><br><span class="line">  <span class="meta">@Autowired</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">DesignTacoController</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        IngredientRepository ingredientRepo, </span></span></span><br><span class="line"><span class="function"><span class="params">        TacoRepository designRepo)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.ingredientRepo = ingredientRepo;</span><br><span class="line">    <span class="keyword">this</span>.designRepo = designRepo;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//end::bothRepoCtor[]</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// tag::modelAttributes[]</span></span><br><span class="line">  <span class="meta">@ModelAttribute</span>(name = <span class="string">"order"</span>)</span><br><span class="line">  <span class="function"><span class="keyword">public</span> Order <span class="title">order</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Order();</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@ModelAttribute</span>(name = <span class="string">"taco"</span>)</span><br><span class="line">  <span class="function"><span class="keyword">public</span> Taco <span class="title">taco</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Taco();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// end::modelAttributes[]</span></span><br><span class="line">  <span class="comment">// tag::showDesignForm[]</span></span><br><span class="line">  </span><br><span class="line">  <span class="meta">@GetMapping</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">showDesignForm</span><span class="params">(Model model)</span> </span>&#123;</span><br><span class="line">    List&lt;Ingredient&gt; ingredients = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    ingredientRepo.findAll().forEach(i -&gt; ingredients.add(i));</span><br><span class="line">    </span><br><span class="line">    Ingredient.Type[] types = Ingredient.Type.values();</span><br><span class="line">    <span class="keyword">for</span> (Ingredient.Type type : types) &#123;</span><br><span class="line">      model.addAttribute(type.toString().toLowerCase(), </span><br><span class="line">          filterByType(ingredients, type));      </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">"design"</span>;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">//end::showDesignForm[]</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//tag::processDesign[]</span></span><br><span class="line">  <span class="meta">@PostMapping</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">processDesign</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">      @Valid Taco design, Errors errors, </span></span></span><br><span class="line"><span class="function"><span class="params">      @ModelAttribute Order order)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (errors.hasErrors()) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">"design"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Taco saved = designRepo.save(design);</span><br><span class="line">    order.addDesign(saved);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">"redirect:/orders/current"</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//end::processDesign[]</span></span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">private</span> List&lt;Ingredient&gt; <span class="title">filterByType</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">      List&lt;Ingredient&gt; ingredients, Ingredient.Type type)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> ingredients</span><br><span class="line">              .stream()</span><br><span class="line">              .filter(x -&gt; x.getType().equals(type))</span><br><span class="line">              .collect(Collectors.toList());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">//tag::classShell[]</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">  ...</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">//end::classShell[]</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"><span class="comment">//tag::classShell[]</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//end::classShell[]</span></span><br></pre></td></tr></table></figure>

<h4 id="3-1-3-定义模式和加载数据"><a href="#3-1-3-定义模式和加载数据" class="headerlink" title="3.1.3 定义模式和加载数据"></a>3.1.3 定义模式和加载数据</h4><p><img src="https://pic.imgdb.cn/item/5f185baf14195aa594888aca.jpg" alt=""></p>
<p>schema.sql</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">if</span> <span class="keyword">not</span> <span class="keyword">exists</span> Ingredient (</span><br><span class="line">  <span class="keyword">id</span> <span class="built_in">varchar</span>(<span class="number">4</span>) <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">  <span class="keyword">name</span> <span class="built_in">varchar</span>(<span class="number">25</span>) <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">  <span class="keyword">type</span> <span class="built_in">varchar</span>(<span class="number">10</span>) <span class="keyword">not</span> <span class="literal">null</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">if</span> <span class="keyword">not</span> <span class="keyword">exists</span> Taco (</span><br><span class="line">  <span class="keyword">id</span> <span class="keyword">identity</span>,</span><br><span class="line">  <span class="keyword">name</span> <span class="built_in">varchar</span>(<span class="number">50</span>) <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">  createdAt <span class="built_in">timestamp</span> <span class="keyword">not</span> <span class="literal">null</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">if</span> <span class="keyword">not</span> <span class="keyword">exists</span> Taco_Ingredients (</span><br><span class="line">  taco <span class="built_in">bigint</span> <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">  ingredient <span class="built_in">varchar</span>(<span class="number">4</span>) <span class="keyword">not</span> <span class="literal">null</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> Taco_Ingredients</span><br><span class="line">    <span class="keyword">add</span> <span class="keyword">foreign</span> <span class="keyword">key</span> (taco) <span class="keyword">references</span> Taco(<span class="keyword">id</span>);</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> Taco_Ingredients</span><br><span class="line">    <span class="keyword">add</span> <span class="keyword">foreign</span> <span class="keyword">key</span> (ingredient) <span class="keyword">references</span> Ingredient(<span class="keyword">id</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">if</span> <span class="keyword">not</span> <span class="keyword">exists</span> Taco_Order (</span><br><span class="line">   <span class="keyword">id</span> <span class="keyword">identity</span>,</span><br><span class="line">   deliveryName <span class="built_in">varchar</span>(<span class="number">50</span>) <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">   deliveryStreet <span class="built_in">varchar</span>(<span class="number">50</span>) <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">   deliveryCity <span class="built_in">varchar</span>(<span class="number">50</span>) <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">   deliveryState <span class="built_in">varchar</span>(<span class="number">2</span>) <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">   deliveryZip <span class="built_in">varchar</span>(<span class="number">10</span>) <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">   ccNumber <span class="built_in">varchar</span>(<span class="number">16</span>) <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">   ccExpiration <span class="built_in">varchar</span>(<span class="number">5</span>) <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">   ccCVV <span class="built_in">varchar</span>(<span class="number">3</span>) <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">    placedAt <span class="built_in">timestamp</span> <span class="keyword">not</span> <span class="literal">null</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">if</span> <span class="keyword">not</span> <span class="keyword">exists</span> Taco_Order_Tacos (</span><br><span class="line">   tacoOrder <span class="built_in">bigint</span> <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">   taco <span class="built_in">bigint</span> <span class="keyword">not</span> <span class="literal">null</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> Taco_Order_Tacos</span><br><span class="line">    <span class="keyword">add</span> <span class="keyword">foreign</span> <span class="keyword">key</span> (tacoOrder) <span class="keyword">references</span> Taco_Order(<span class="keyword">id</span>);</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> Taco_Order_Tacos</span><br><span class="line">    <span class="keyword">add</span> <span class="keyword">foreign</span> <span class="keyword">key</span> (taco) <span class="keyword">references</span> Taco(<span class="keyword">id</span>);</span><br></pre></td></tr></table></figure>

<p>问题是这些定义放在什么地方，实际上在resource表下面就可以，在应用启动会基于数据库执行这个文件的SQL,保存为schema.sql</p>
<p>然后还有data.sql</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">delete from Taco_Order_Tacos;</span><br><span class="line">delete from Taco_Ingredients;</span><br><span class="line">delete from Taco;</span><br><span class="line">delete from Taco_Order;</span><br><span class="line"></span><br><span class="line">delete from Ingredient;</span><br><span class="line"><span class="function">insert into <span class="title">Ingredient</span> <span class="params">(id, name, type)</span> </span></span><br><span class="line"><span class="function">                <span class="title">values</span> <span class="params">(<span class="string">'FLTO'</span>, <span class="string">'Flour Tortilla'</span>, <span class="string">'WRAP'</span>)</span></span>;</span><br><span class="line"><span class="function">insert into <span class="title">Ingredient</span> <span class="params">(id, name, type)</span> </span></span><br><span class="line"><span class="function">                <span class="title">values</span> <span class="params">(<span class="string">'COTO'</span>, <span class="string">'Corn Tortilla'</span>, <span class="string">'WRAP'</span>)</span></span>;</span><br><span class="line"><span class="function">insert into <span class="title">Ingredient</span> <span class="params">(id, name, type)</span> </span></span><br><span class="line"><span class="function">                <span class="title">values</span> <span class="params">(<span class="string">'GRBF'</span>, <span class="string">'Ground Beef'</span>, <span class="string">'PROTEIN'</span>)</span></span>;</span><br><span class="line"><span class="function">insert into <span class="title">Ingredient</span> <span class="params">(id, name, type)</span> </span></span><br><span class="line"><span class="function">                <span class="title">values</span> <span class="params">(<span class="string">'CARN'</span>, <span class="string">'Carnitas'</span>, <span class="string">'PROTEIN'</span>)</span></span>;</span><br><span class="line"><span class="function">insert into <span class="title">Ingredient</span> <span class="params">(id, name, type)</span> </span></span><br><span class="line"><span class="function">                <span class="title">values</span> <span class="params">(<span class="string">'TMTO'</span>, <span class="string">'Diced Tomatoes'</span>, <span class="string">'VEGGIES'</span>)</span></span>;</span><br><span class="line"><span class="function">insert into <span class="title">Ingredient</span> <span class="params">(id, name, type)</span> </span></span><br><span class="line"><span class="function">                <span class="title">values</span> <span class="params">(<span class="string">'LETC'</span>, <span class="string">'Lettuce'</span>, <span class="string">'VEGGIES'</span>)</span></span>;</span><br><span class="line"><span class="function">insert into <span class="title">Ingredient</span> <span class="params">(id, name, type)</span> </span></span><br><span class="line"><span class="function">                <span class="title">values</span> <span class="params">(<span class="string">'CHED'</span>, <span class="string">'Cheddar'</span>, <span class="string">'CHEESE'</span>)</span></span>;</span><br><span class="line"><span class="function">insert into <span class="title">Ingredient</span> <span class="params">(id, name, type)</span> </span></span><br><span class="line"><span class="function">                <span class="title">values</span> <span class="params">(<span class="string">'JACK'</span>, <span class="string">'Monterrey Jack'</span>, <span class="string">'CHEESE'</span>)</span></span>;</span><br><span class="line"><span class="function">insert into <span class="title">Ingredient</span> <span class="params">(id, name, type)</span> </span></span><br><span class="line"><span class="function">                <span class="title">values</span> <span class="params">(<span class="string">'SLSA'</span>, <span class="string">'Salsa'</span>, <span class="string">'SAUCE'</span>)</span></span>;</span><br><span class="line"><span class="function">insert into <span class="title">Ingredient</span> <span class="params">(id, name, type)</span> </span></span><br><span class="line"><span class="function">                <span class="title">values</span> <span class="params">(<span class="string">'SRCR'</span>, <span class="string">'Sour Cream'</span>, <span class="string">'SAUCE'</span>)</span></span>;</span><br></pre></td></tr></table></figure>

<h3 id="3-2-使用Spring-DataJpa-持久化数据"><a href="#3-2-使用Spring-DataJpa-持久化数据" class="headerlink" title="3.2 使用Spring DataJpa 持久化数据"></a>3.2 使用Spring DataJpa 持久化数据</h3><ul>
<li>Spring Data JPA：基于关系型数据可以进行JPA持久化；</li>
<li>Spring Data MongoDB：持久化到Mongo文档数据库；</li>
<li>Spring Data Neo4j：持久化到Neo4j图数据库；</li>
<li>Spring Data Redis：持久化到 Redis Key-Value存储；</li>
<li>Spring Data Cassandra：持久化到Cassandra数据库。</li>
</ul>
<p>​    Spring Data提供了一项有趣且最有用的特性：基于repository规范接口自动生成repository的功能。</p>
<h4 id="3-2-1-添加Spring-Data-JPA到项目中"><a href="#3-2-1-添加Spring-Data-JPA到项目中" class="headerlink" title="3.2.1 添加Spring Data JPA到项目中"></a>3.2.1 添加Spring Data JPA到项目中</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-jpa<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>不仅会引入jpa，还会传递性地将Hibernate作为JPA实现引入进来。如果不想用Hibernate，比如想用EclipseLink来替代：</p>
<p><img src="https://pic.imgdb.cn/item/5f199e6e14195aa594669c09.jpg" alt=""></p>
<p>​    可能还会涉及到其他变更，具体参考JPA文档。</p>
<h4 id="3-2-2-将领域类标准为实体"><a href="#3-2-2-将领域类标准为实体" class="headerlink" title="3.2.2 将领域类标准为实体"></a>3.2.2 将领域类标准为实体</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span>(access=AccessLevel.PRIVATE, force=<span class="keyword">true</span>)</span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Ingredient</span> </span>&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Id</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> String id;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> String name;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> Type type;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">enum</span> Type &#123;</span><br><span class="line">    WRAP, PROTEIN, VEGGIES, CHEESE, SAUCE</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>taco类，可以用注解让其新增的数据自动生成id</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Taco</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Id</span></span><br><span class="line">  <span class="meta">@GeneratedValue</span>(strategy=GenerationType.AUTO)</span><br><span class="line">  <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@NotNull</span></span><br><span class="line">  <span class="meta">@Size</span>(min=<span class="number">5</span>, message=<span class="string">"Name must be at least 5 characters long"</span>)</span><br><span class="line">  <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> Date createdAt;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@ManyToMany</span>(targetEntity=Ingredient<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">  @<span class="title">Size</span>(<span class="title">min</span></span>=<span class="number">1</span>, message=<span class="string">"You must choose at least 1 ingredient"</span>)</span><br><span class="line">  <span class="keyword">private</span> List&lt;Ingredient&gt; ingredients = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@PrePersist</span></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">createdAt</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.createdAt = <span class="keyword">new</span> Date();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>order</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table</span>(name=<span class="string">"Taco_Order"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Order</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Id</span></span><br><span class="line">  <span class="meta">@GeneratedValue</span>(strategy=GenerationType.AUTO)</span><br><span class="line">  <span class="keyword">private</span> Long id;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">private</span> Date placedAt;</span><br><span class="line">  </span><br><span class="line"><span class="comment">//end::allButDetailProperties[]</span></span><br><span class="line">  <span class="meta">@NotBlank</span>(message=<span class="string">"Delivery name is required"</span>)</span><br><span class="line">  <span class="keyword">private</span> String deliveryName;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@NotBlank</span>(message=<span class="string">"Street is required"</span>)</span><br><span class="line">  <span class="keyword">private</span> String deliveryStreet;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@NotBlank</span>(message=<span class="string">"City is required"</span>)</span><br><span class="line">  <span class="keyword">private</span> String deliveryCity;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@NotBlank</span>(message=<span class="string">"State is required"</span>)</span><br><span class="line">  <span class="keyword">private</span> String deliveryState;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@NotBlank</span>(message=<span class="string">"Zip code is required"</span>)</span><br><span class="line">  <span class="keyword">private</span> String deliveryZip;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@CreditCardNumber</span>(message=<span class="string">"Not a valid credit card number"</span>)</span><br><span class="line">  <span class="keyword">private</span> String ccNumber;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Pattern</span>(regexp=<span class="string">"^(0[1-9]|1[0-2])([\\/])([1-9][0-9])$"</span>,</span><br><span class="line">           message=<span class="string">"Must be formatted MM/YY"</span>)</span><br><span class="line">  <span class="keyword">private</span> String ccExpiration;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Digits</span>(integer=<span class="number">3</span>, fraction=<span class="number">0</span>, message=<span class="string">"Invalid CVV"</span>)</span><br><span class="line">  <span class="keyword">private</span> String ccCVV;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">  //tag::allButDetailProperties[]</span></span><br><span class="line"><span class="comment">  ...</span></span><br><span class="line"><span class="comment">  </span></span><br><span class="line"><span class="comment">  //end::allButDetailProperties[]</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  </span><br><span class="line"><span class="comment">//tag::allButDetailProperties[]</span></span><br><span class="line">  <span class="meta">@ManyToMany</span>(targetEntity=Taco<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">  <span class="title">private</span> <span class="title">List</span>&lt;<span class="title">Taco</span>&gt; <span class="title">tacos</span> </span>= <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addDesign</span><span class="params">(Taco design)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.tacos.add(design);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@PrePersist</span></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">placedAt</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.placedAt = <span class="keyword">new</span> Date();</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//end::allButDetailProperties[]</span></span><br></pre></td></tr></table></figure>

<h4 id="3-2-3-声明JPA-repository"><a href="#3-2-3-声明JPA-repository" class="headerlink" title="3.2.3 声明JPA repository"></a>3.2.3 声明JPA repository</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.data.repository.CrudRepository;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> tacos.Ingredient;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IngredientRepository</span> </span></span><br><span class="line"><span class="class">         <span class="keyword">extends</span> <span class="title">CrudRepository</span>&lt;<span class="title">Ingredient</span>, <span class="title">String</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.data.repository.CrudRepository;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> tacos.Order;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">OrderRepository</span> </span></span><br><span class="line"><span class="class">         <span class="keyword">extends</span> <span class="title">CrudRepository</span>&lt;<span class="title">Order</span>, <span class="title">Long</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.data.repository.CrudRepository;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> tacos.Taco;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">TacoRepository</span> </span></span><br><span class="line"><span class="class">         <span class="keyword">extends</span> <span class="title">CrudRepository</span>&lt;<span class="title">Taco</span>, <span class="title">Long</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="3-2-4-自定义JPA-repository"><a href="#3-2-4-自定义JPA-repository" class="headerlink" title="3.2.4 自定义JPA repository"></a>3.2.4 自定义JPA repository</h4><p>​    比如获取投递到指定邮编的订单,只需要在repository中声明：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">List&lt;Order&gt; <span class="title">findByDeliveryZip</span><span class="params">(String deliveryZip)</span></span>;</span><br></pre></td></tr></table></figure>

<p>​    创建repository实现时，会检查repository接口的所有方法，解析名称，并基于持久化对象推测方法意图。本质上就是定义了一组小型的领域特定语言(DSL),持久化的细节都是用过repository方法的签名来描述的。</p>
<p>​    更复杂样例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt; Order&gt; readOrdersByDeliveryZipAndPlacedAtBetween( String deliveryZip, Date startDate, Date endDate);</span><br></pre></td></tr></table></figure>

<p><img src="https://pic.imgdb.cn/item/5f19a0e714195aa594689d7c.jpg" alt=""></p>
<p>​    除了Equals和Between之外，Spring Data方法签名还支持如下操作符：</p>
<ul>
<li>IsAfter、After、IsGreaterThan、GreaterThan</li>
<li>IsGreaterThanEqual、GreaterThan</li>
<li>IsBefore、Before、IsLessThan、LessThan</li>
<li>IsLessThanEqual、LessThanEqual</li>
<li>IsBetween、Between</li>
<li>IsNull、Null</li>
<li>IsNotNull、NotNull</li>
<li>IsIn、In</li>
<li>IsNotIn、NotIn</li>
<li>IsStartingWith、StartingWith、StartsWith</li>
<li>IsEndingWith、EndingWith、EndsWith</li>
<li>IsContaining、Containing、Contains</li>
<li>IsLike、Like</li>
<li>IsNotLike、NotLike</li>
<li>IsNot、Not</li>
<li>IgnoringCase、IgnoresCase</li>
</ul>
<p>作为IgnoringCase、IgnoresCase的替代方案还可以加上AllIgnoreingCase或者AllIgnoresCase，它会忽略所有String比较的大小写。</p>
<p>对于更复杂的查询，可以添加@Query注解</p>
<p><img src="https://pic.imgdb.cn/item/5f19a39d14195aa59469f9b3.jpg" alt=""></p>
<h3 id="3-3-小结"><a href="#3-3-小结" class="headerlink" title="3.3 小结"></a>3.3 小结</h3><ul>
<li>Spring的JdbcTempdate能够极大地简化JDBC的使用。</li>
<li>在我们需要知道数据库所生产的ID值时，可以组合使用PreparedStatementCreator和KeyHolder</li>
<li>为了简化数据的插入，可以使用SimpleJdbcInsert</li>
<li>Spring Data JPA可以极大地简化JPA持久化，只需要编写Repository接口即可</li>
</ul>
<h2 id="第4章-保护Spring"><a href="#第4章-保护Spring" class="headerlink" title="第4章 保护Spring"></a>第4章 保护Spring</h2><p>本章内容：</p>
<ul>
<li>自动配置Spring Security</li>
<li>设置自定义的用户存储</li>
<li>自定义登录页</li>
<li>防范CSRF攻击</li>
<li>知道用户是谁</li>
</ul>
<p>​    信息是最重要的东西，安全性是绝大多数系统的一个重要切面。</p>
<h3 id="4-1-启用Spring-Security"><a href="#4-1-启用Spring-Security" class="headerlink" title="4.1 启用Spring Security"></a>4.1 启用Spring Security</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.security<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-security-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>​    添加后启动项目，应用将会弹出一个HTTP basic认证对话框并提示你进行认证。想通过认证需要用户名和密码。用户名为user，密码在日志中</p>
<p><img src="https://pic.imgdb.cn/item/5f1d783514195aa594bd5139.jpg" alt=""></p>
<p>​    得到了如下的安全特性：</p>
<ul>
<li>所有的HTTP请求路径都需要认证；</li>
<li>不需要特定的角色和权限；</li>
<li>没有登录页面；</li>
<li>认证过程是通过HTTP Basic认证对话框实现的；</li>
<li>系统只有一个用户，用户名是user</li>
</ul>
<h3 id="4-2-配置Spring-Security"><a href="#4-2-配置Spring-Security" class="headerlink" title="4.2 配置Spring Security"></a>4.2 配置Spring Security</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableWebSecurity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SecurityConfig</span> <span class="keyword">extends</span> <span class="title">WebSecurityConfigurerAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>​    它提供了一个简单的登录页</p>
<p><img src="https://pic.imgdb.cn/item/5f1d793b14195aa594be47fc.jpg" alt=""></p>
<p>​    Spring Security为配置用户存储提供了多个可选方案：</p>
<ul>
<li>基于内存的用户存储；</li>
<li>基于JDBC的用户存储；</li>
<li>以LDAP作为后台的用户存储；</li>
<li>自定义用户详情服务。</li>
</ul>
<p>​    不管使用哪种用户存储，可以通过覆盖WebSecurityConfigurerAdapter中的configure方法来进行配置。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="4-2-1-基于内存的用户存储"><a href="#4-2-1-基于内存的用户存储" class="headerlink" title="4.2.1 基于内存的用户存储"></a>4.2.1 基于内存的用户存储</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">  </span><br><span class="line">  auth</span><br><span class="line">    .inMemoryAuthentication()</span><br><span class="line">      .withUser(<span class="string">"buzz"</span>)</span><br><span class="line">        .password(<span class="string">"infinity"</span>)</span><br><span class="line">        .authorities(<span class="string">"ROLE_USER"</span>)</span><br><span class="line">      .and()</span><br><span class="line">      .withUser(<span class="string">"woody"</span>)</span><br><span class="line">        .password(<span class="string">"bullseye"</span>)</span><br><span class="line">        .authorities(<span class="string">"ROLE_USER"</span>);</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="4-2-2-基于JDBC的用户存储"><a href="#4-2-2-基于JDBC的用户存储" class="headerlink" title="4.2.2 基于JDBC的用户存储"></a>4.2.2 基于JDBC的用户存储</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">DataSource dataSource;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">  </span><br><span class="line">  auth</span><br><span class="line">    .jdbcAuthentication()</span><br><span class="line">      .dataSource(dataSource);</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="重写默认的用户查询功能"><a href="#重写默认的用户查询功能" class="headerlink" title="重写默认的用户查询功能"></a>重写默认的用户查询功能</h5><p>Spring Security内部的查询用户SQL:</p>
<p><img src="https://pic.imgdb.cn/item/5f1d7c5d14195aa594c12964.jpg" alt=""></p>
<p>自定义查询</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">  </span><br><span class="line">  auth</span><br><span class="line">    .jdbcAuthentication()</span><br><span class="line">      .dataSource(dataSource)</span><br><span class="line">      .usersByUsernameQuery(</span><br><span class="line">          <span class="string">"select username, password, enabled from Users "</span> +</span><br><span class="line">          <span class="string">"where username=?"</span>)</span><br><span class="line">      .authoritiesByUsernameQuery(</span><br><span class="line">          <span class="string">"select username, authority from UserAuthorities "</span> +</span><br><span class="line">          <span class="string">"where username=?"</span>);</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="使用转码后的密码"><a href="#使用转码后的密码" class="headerlink" title="使用转码后的密码"></a>使用转码后的密码</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">  </span><br><span class="line">  auth</span><br><span class="line">    .jdbcAuthentication()</span><br><span class="line">      .dataSource(dataSource)</span><br><span class="line">      .usersByUsernameQuery(</span><br><span class="line">          <span class="string">"select username, password, enabled from Users "</span> +</span><br><span class="line">          <span class="string">"where username=?"</span>)</span><br><span class="line">      .authoritiesByUsernameQuery(</span><br><span class="line">          <span class="string">"select username, authority from UserAuthorities "</span> +</span><br><span class="line">          <span class="string">"where username=?"</span>)</span><br><span class="line">      .passwordEncoder(<span class="keyword">new</span> StandardPasswordEncoder(<span class="string">"53cr3t"</span>);</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>加密模块包括了多个实现：</p>
<ul>
<li>BCryptPasswordEncoder：使用bcrypt强哈希加密；</li>
<li>NoOpPasswordEncoder：不进行任何转码；</li>
<li>Pbkdf2PasswordEncoder：使用PDKDF2加密；</li>
<li>SCryptPasswordEncoder：使用scrypt哈希加密；</li>
<li>StandardPasswordEncoder：使用SHA-256哈希加密。</li>
</ul>
<p>​    不管使用哪一个转码器，数据库中的密码永远不会解码。登录时的策略与之相反，输入的密码按相同算法进行转码，然后和数据库做对比。</p>
<h4 id="4-2-3-以LDAP作为后端的用户存储"><a href="#4-2-3-以LDAP作为后端的用户存储" class="headerlink" title="4.2.3 以LDAP作为后端的用户存储"></a>4.2.3 以LDAP作为后端的用户存储</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">  auth</span><br><span class="line">    .ldapAuthentication()</span><br><span class="line">      .userSearchFilter(<span class="string">"(uid=&#123;0&#125;)"</span>)</span><br><span class="line">      .groupSearchFilter(<span class="string">"member=&#123;0&#125;"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>userSearchFilter和groupSearchFilter 用来基础LDAP查询提供过滤条件，分别用于搜索用户和组。默认情况下，用户和组的基础查询都是空的，表明搜索会在LDAP层级结构的根开始。可以改变这个默认行为：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">  auth</span><br><span class="line">    .ldapAuthentication()</span><br><span class="line">      .userSearchFilter(<span class="string">"(uid=&#123;0&#125;)"</span>)</span><br><span class="line">      .groupSearchFilter(<span class="string">"member=&#123;0&#125;"</span>)</span><br><span class="line">      .groupSearchBase(<span class="string">" ou= groups"</span>)</span><br><span class="line">      .groupSearchFilter(<span class="string">" member=&#123; 0&#125;"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="配置密码比对"><a href="#配置密码比对" class="headerlink" title="配置密码比对"></a>配置密码比对</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">  auth</span><br><span class="line">    .ldapAuthentication()</span><br><span class="line">      .userSearchFilter(<span class="string">"(uid=&#123;0&#125;)"</span>)</span><br><span class="line">      .groupSearchFilter(<span class="string">"member=&#123;0&#125;"</span>)</span><br><span class="line">      .groupSearchBase(<span class="string">" ou= groups"</span>)</span><br><span class="line">      .groupSearchFilter(<span class="string">" member=&#123; 0&#125;"</span>)</span><br><span class="line">      .passwordCompare();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​    默认情况下，表单中提供的密码将会与LDAP条目中的userPassword属性进行比对。</p>
<p>​    可以通过passwordAttribute（）方法来声明密码属性的名称:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">  auth</span><br><span class="line">    .ldapAuthentication()</span><br><span class="line">      .userSearchFilter(<span class="string">"(uid=&#123;0&#125;)"</span>)</span><br><span class="line">      .groupSearchFilter(<span class="string">"member=&#123;0&#125;"</span>)</span><br><span class="line">      .groupSearchBase(<span class="string">"ou= groups"</span>)</span><br><span class="line">      .groupSearchFilter(<span class="string">"member=&#123; 0&#125;"</span>)</span><br><span class="line">      .passwordCompare()</span><br><span class="line">      .passwordEncoder(<span class="keyword">new</span> BCryptPasswordEncoder())</span><br><span class="line">      .passwordAttribute(<span class="string">"passcode"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="引用远程的LDAP服务器"><a href="#引用远程的LDAP服务器" class="headerlink" title="引用远程的LDAP服务器"></a>引用远程的LDAP服务器</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">  auth</span><br><span class="line">    .ldapAuthentication()</span><br><span class="line">      .userSearchFilter(<span class="string">"(uid=&#123;0&#125;)"</span>)</span><br><span class="line">      .groupSearchFilter(<span class="string">"member=&#123;0&#125;"</span>)</span><br><span class="line">      .groupSearchBase(<span class="string">"ou= groups"</span>)</span><br><span class="line">      .groupSearchFilter(<span class="string">"member=&#123; 0&#125;"</span>)</span><br><span class="line">      .passwordCompare()</span><br><span class="line">      .passwordEncoder(<span class="keyword">new</span> BCryptPasswordEncoder())</span><br><span class="line">      .passwordAttribute(<span class="string">"passcode"</span>)</span><br><span class="line">      .contextSource()</span><br><span class="line">      .url(<span class="string">" ldap:// tacocloud. com: 389/ dc= tacocloud, dc= com"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="配置嵌入式的LDAP服务器"><a href="#配置嵌入式的LDAP服务器" class="headerlink" title="配置嵌入式的LDAP服务器"></a>配置嵌入式的LDAP服务器</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">  auth</span><br><span class="line">    .ldapAuthentication()</span><br><span class="line">      .userSearchFilter(<span class="string">"(uid=&#123;0&#125;)"</span>)</span><br><span class="line">      .groupSearchFilter(<span class="string">"member=&#123;0&#125;"</span>)</span><br><span class="line">      .groupSearchBase(<span class="string">"ou= groups"</span>)</span><br><span class="line">      .groupSearchFilter(<span class="string">"member=&#123; 0&#125;"</span>)</span><br><span class="line">      .passwordCompare()</span><br><span class="line">      .passwordEncoder(<span class="keyword">new</span> BCryptPasswordEncoder())</span><br><span class="line">      .passwordAttribute(<span class="string">"passcode"</span>)</span><br><span class="line">      .contextSource()</span><br><span class="line">      .url(<span class="string">" ldap:// tacocloud. com: 389/ dc= tacocloud, dc= com"</span>)</span><br><span class="line">      .contextSource()</span><br><span class="line">      .root(<span class="string">" dc= tacocloud, dc= com"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​    LDAP服务器启动时，尝试在类路径下寻找LDIF文件来加载数据。LDIF(LDAP Data Interchange Format, LDAP数据交换格式)是以文本文件展示LDAP数据的标准方式。每条记录可以有一行或多行，每行包含一个name:value配对信息。记录之间用空行进行分割。</p>
<p>​    如果不想从整个根路径下搜索，可以通过ldif()方法来明确指定加载那个LDIF文件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">  auth</span><br><span class="line">    .ldapAuthentication()</span><br><span class="line">      .userSearchFilter(<span class="string">"(uid=&#123;0&#125;)"</span>)</span><br><span class="line">      .groupSearchFilter(<span class="string">"member=&#123;0&#125;"</span>)</span><br><span class="line">      .groupSearchBase(<span class="string">"ou= groups"</span>)</span><br><span class="line">      .groupSearchFilter(<span class="string">"member=&#123; 0&#125;"</span>)</span><br><span class="line">      .passwordCompare()</span><br><span class="line">      .passwordEncoder(<span class="keyword">new</span> BCryptPasswordEncoder())</span><br><span class="line">      .passwordAttribute(<span class="string">"passcode"</span>)</span><br><span class="line">      .contextSource()</span><br><span class="line">      .url(<span class="string">" ldap:// tacocloud. com: 389/ dc= tacocloud, dc= com"</span>)</span><br><span class="line">      .contextSource()</span><br><span class="line">      .root(<span class="string">" dc= tacocloud, dc= com"</span>)</span><br><span class="line">      .ldif(<span class="string">" classpath: users. ldif"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如下就是一个ldif文件</p>
<p><img src="https://pic.imgdb.cn/item/5f1d830914195aa594c89d61.jpg" alt=""></p>
<p><img src="https://pic.imgdb.cn/item/5f1d831514195aa594c8ad8b.jpg" alt=""></p>
<h3 id="4-2-4-自定义用户认证"><a href="#4-2-4-自定义用户认证" class="headerlink" title="4.2.4 自定义用户认证"></a>4.2.4 自定义用户认证</h3><h5 id="定义用户领域对象和持久化"><a href="#定义用户领域对象和持久化" class="headerlink" title="定义用户领域对象和持久化"></a>定义用户领域对象和持久化</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span>(access=AccessLevel.PRIVATE, force=<span class="keyword">true</span>)</span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">implements</span> <span class="title">UserDetails</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Id</span></span><br><span class="line">  <span class="meta">@GeneratedValue</span>(strategy=GenerationType.AUTO)</span><br><span class="line">  <span class="keyword">private</span> Long id;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> String username;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> String password;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> String fullname;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> String street;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> String city;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> String state;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> String zip;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> String phoneNumber;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> Collection&lt;? extends GrantedAuthority&gt; getAuthorities() &#123;</span><br><span class="line">    <span class="keyword">return</span> Arrays.asList(<span class="keyword">new</span> SimpleGrantedAuthority(<span class="string">"ROLE_USER"</span>));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isAccountNonExpired</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isAccountNonLocked</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isCredentialsNonExpired</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEnabled</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>实现了UserDetails接口</p>
<p>定义Repository</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserRepository</span> <span class="keyword">extends</span> <span class="title">CrudRepository</span>&lt;<span class="title">User</span>, <span class="title">Long</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function">User <span class="title">findByUsername</span><span class="params">(String username)</span></span>;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="创建用户详情服务"><a href="#创建用户详情服务" class="headerlink" title="创建用户详情服务"></a>创建用户详情服务</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserRepositoryUserDetailsService</span> </span></span><br><span class="line"><span class="class">        <span class="keyword">implements</span> <span class="title">UserDetailsService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> UserRepository userRepo;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Autowired</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">UserRepositoryUserDetailsService</span><span class="params">(UserRepository userRepo)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.userRepo = userRepo;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> UserDetails <span class="title">loadUserByUsername</span><span class="params">(String username)</span></span></span><br><span class="line"><span class="function">      <span class="keyword">throws</span> UsernameNotFoundException </span>&#123;</span><br><span class="line">    User user = userRepo.findByUsername(username);</span><br><span class="line">    <span class="keyword">if</span> (user != <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> UsernameNotFoundException(</span><br><span class="line">                    <span class="string">"User '"</span> + username + <span class="string">"' not found"</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>在Security配置中配置用户详情服务</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">  auth</span><br><span class="line">    .userDetailsService(userDetailsService)</span><br><span class="line">    .passwordEncoder(encoder());</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="注册用户"><a href="#注册用户" class="headerlink" title="注册用户"></a>注册用户</h5><p>略</p>
<h3 id="4-3-保护Web请求"><a href="#4-3-保护Web请求" class="headerlink" title="4.3 保护Web请求"></a>4.3 保护Web请求</h3><p>配置安全性规则</p>
<ul>
<li>为某个请求提供服务前，先满足特定条件</li>
<li>配置自定义的登录页</li>
<li>支持用户退出应用</li>
<li>预防跨站请求伪造</li>
</ul>
<h4 id="4-3-1-保护请求"><a href="#4-3-1-保护请求" class="headerlink" title="4.3.1 保护请求"></a>4.3.1 保护请求</h4><p><img src="https://pic.imgdb.cn/item/5f20498214195aa594320c52.jpg" alt=""></p>
<p><img src="https://pic.imgdb.cn/item/5f2048ad14195aa594313130.jpg" alt=""></p>
<p><img src="https://pic.imgdb.cn/item/5f2048d414195aa59431598a.jpg" alt=""></p>
<p>还支持access方法来扩展</p>
<p><img src="https://pic.imgdb.cn/item/5f20491f14195aa59431a303.jpg" alt=""></p>
<p><img src="https://pic.imgdb.cn/item/5f20492a14195aa59431ad1a.jpg" alt=""></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">http</span><br><span class="line">    .authorizeRequests()</span><br><span class="line">      .antMatchers(<span class="string">"/design"</span>, <span class="string">"/orders"</span>)</span><br><span class="line">        .access(<span class="string">"hasRole('ROLE_USER')"</span>)</span><br><span class="line">      .antMatchers(<span class="string">"/"</span>, <span class="string">"/**"</span>).access(<span class="string">"permitAll"</span>)</span><br></pre></td></tr></table></figure>



<h4 id="4-3-2-自定义登录页"><a href="#4-3-2-自定义登录页" class="headerlink" title="4.3.2 自定义登录页"></a>4.3.2 自定义登录页</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.and()</span><br><span class="line">  .formLogin()</span><br><span class="line">    .loginPage(<span class="string">"/login"</span>)</span><br></pre></td></tr></table></figure>

<p>视图控制器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebConfig</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// tag::customLoginViewController[]</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addViewControllers</span><span class="params">(ViewControllerRegistry registry)</span> </span>&#123;</span><br><span class="line">    registry.addViewController(<span class="string">"/"</span>).setViewName(<span class="string">"home"</span>);</span><br><span class="line">    registry.addViewController(<span class="string">"/abc"</span>).setViewName(<span class="string">"home"</span>);</span><br><span class="line">    registry.addViewController(<span class="string">"/login"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// end::customLoginViewController[]</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>html略</p>
<p>自定义路径和输入域的名称</p>
<p><img src="https://pic.imgdb.cn/item/5f204cec14195aa5943663e8.jpg" alt=""></p>
<p>指定默认的成功页。</p>
<p><img src="https://pic.imgdb.cn/item/5f204d2814195aa59436a08d.jpg" alt=""></p>
<h4 id="4-3-3-退出"><a href="#4-3-3-退出" class="headerlink" title="4.3.3 退出"></a>4.3.3 退出</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.and()</span><br><span class="line">  .logout()</span><br><span class="line">    .logoutSuccessUrl(<span class="string">"/"</span>)</span><br></pre></td></tr></table></figure>



<h4 id="4-3-4-防止跨站请求伪造"><a href="#4-3-4-防止跨站请求伪造" class="headerlink" title="4.3.4 防止跨站请求伪造"></a>4.3.4 防止跨站请求伪造</h4><p>​    为了防止跨域请求伪造，可以在展现表单的时候生成一个CSRF token，并且放在隐藏域中，临时存储起来。提交表单时和其他表单数据一起发送至服务端与最初的token进行对比。匹配才允许处理。</p>
<p>​    最好不要禁用，如果需要禁用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.and()</span><br><span class="line">.csrf()</span><br><span class="line">.disable()</span><br></pre></td></tr></table></figure>

<h3 id="4-4-了解用户是谁"><a href="#4-4-了解用户是谁" class="headerlink" title="4.4 了解用户是谁"></a>4.4 了解用户是谁</h3><p>常用方式如下：</p>
<ul>
<li>注入principal对象到控制器方法中</li>
<li>注入Authentication对象到控制器方法中</li>
<li>使用SecurityContextHolder来获取安全上下文；</li>
<li>使用@AuthenticationPrinciple注解来标注方法。</li>
</ul>
<h3 id="4-5-小结"><a href="#4-5-小结" class="headerlink" title="4.5 小结"></a>4.5 小结</h3><p>略</p>
<h2 id="第5章-使用配置属性"><a href="#第5章-使用配置属性" class="headerlink" title="第5章 使用配置属性"></a>第5章 使用配置属性</h2><p>本章内容：</p>
<ul>
<li>细粒度的自动配置bean</li>
<li>将配置属性应用到组件上</li>
<li>使用Spring Profile</li>
</ul>
<p>​    Spring Boot提供了配置属性(configuration property)的方法。</p>
<h3 id="5-1-细粒度的自动配置"><a href="#5-1-细粒度的自动配置" class="headerlink" title="5.1 细粒度的自动配置"></a>5.1 细粒度的自动配置</h3><p>​    在Spring中有两种（但相关）的配置：</p>
<ul>
<li>bean装配：声明在Spring应用上下文中创建哪些应用组件以及它们之间如何相互注入的配置。</li>
<li>属性注入：设置Spring应用上下文中bean的值的配置。</li>
</ul>
<p><img src="https://pic.imgdb.cn/item/5f2183a914195aa5949aa72d.jpg" alt=""></p>
<h4 id="5-1-1-理解Spring的环境抽象"><a href="#5-1-1-理解Spring的环境抽象" class="headerlink" title="5.1.1 理解Spring的环境抽象"></a>5.1.1 理解Spring的环境抽象</h4><p>​    Spring环境会拉取多个属性源：</p>
<ul>
<li>JVM系统属性；</li>
<li>操作系统环境变量；</li>
<li>命令行参数</li>
<li>应用配置文件</li>
</ul>
<p><img src="https://pic.imgdb.cn/item/5f21841914195aa5949b18fa.jpg" alt=""></p>
<p>​    比如希望Servlet用另一个端口监听请求，而不再使用8080。在application.properties中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">server.port&#x3D;9090</span><br></pre></td></tr></table></figure>

<p>或者application.yml</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">server:</span><br><span class="line">	port: 9090</span><br></pre></td></tr></table></figure>

<p>如果喜欢在外部配置该属性，可以在命令行参数添加</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ java -jar tarcloud-0.0.5-SNAPSHOT.jar --server.port&#x3D;9090</span><br></pre></td></tr></table></figure>

<p>如果希望应用始终在一个特定的端口启动</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ export SERVER_PORT&#x3D;9090</span><br></pre></td></tr></table></figure>

<h4 id="5-1-2-配置数据源"><a href="#5-1-2-配置数据源" class="headerlink" title="5.1.2 配置数据源"></a>5.1.2 配置数据源</h4><p>​    就是配置使用什么数据库或者数据源。</p>
<p>​    此处略。</p>
<h4 id="5-1-3-配置嵌入式服务器"><a href="#5-1-3-配置嵌入式服务器" class="headerlink" title="5.1.3 配置嵌入式服务器"></a>5.1.3 配置嵌入式服务器</h4><p>​    如果将server.port设置为0不会真的在0这个端口启动，而是任选一个可用端口。保证不会和硬件编码的端口号冲突。</p>
<p>​    底层服务器的配置不仅仅局限于一个端口，比如常用给的一项设置就是让它处理HTTPS请求。为了实现这一点，首先要用JDK的keytool命令行工具生成keystore</p>
<p><img src="https://pic.imgdb.cn/item/5f2188ff14195aa5949df844.jpg" alt=""></p>
<p>​    然后设置一些属性，以便在嵌入式服务器中启动HTTPS。但是不如以下方便：</p>
<p><img src="https://pic.imgdb.cn/item/5f21894514195aa5949e2125.jpg" alt=""></p>
<h4 id="5-1-4-配置日志"><a href="#5-1-4-配置日志" class="headerlink" title="5.1.4 配置日志"></a>5.1.4 配置日志</h4><p>​    Spring Boot默认通过Logback配置日志，以Info级别写入到控制台。</p>
<p>​    为了控制日志的配置，可以在类路径的根目录创建一个logback.xml文件。具体怎么配置此处略。</p>
<p>​    不过借助Spring Boot的配置属性功能更加方便。</p>
<p><img src="https://pic.imgdb.cn/item/5f218a3c14195aa5949e9f39.jpg" alt=""></p>
<p>​    具体有哪些属性的配置此处略，用到再看。</p>
<h4 id="5-1-5-使用特定的属性值"><a href="#5-1-5-使用特定的属性值" class="headerlink" title="5.1.5 使用特定的属性值"></a>5.1.5 使用特定的属性值</h4><p>​    比如想创建一个名为greeting.welcome的属性，来源于另外一个属性。</p>
<p><img src="https://pic.imgdb.cn/item/5f218b5a14195aa5949f26ca.jpg" alt=""></p>
<h3 id="5-2-创建自己的配置属性"><a href="#5-2-创建自己的配置属性" class="headerlink" title="5.2 创建自己的配置属性"></a>5.2 创建自己的配置属性</h3><p>​    比如要添加一个pageSize的属性在Controller中</p>
<p><img src="https://pic.imgdb.cn/item/5f218caf14195aa5949fc990.jpg" alt=""></p>
<p>需要注解@ConfigurationProperties</p>
<p>然后在yml中或者在环境变量中，设置该属性。</p>
<p><img src="https://pic.imgdb.cn/item/5f218ce314195aa5949fe00e.jpg" alt=""></p>
<h4 id="5-2-1-定义配置属性的持有者"><a href="#5-2-1-定义配置属性的持有者" class="headerlink" title="5.2.1 定义配置属性的持有者"></a>5.2.1 定义配置属性的持有者</h4><p>​    @ConfigurationProperties通常会放到一种特定类型的Bean中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties</span>(prefix=<span class="string">"taco.orders"</span>)</span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="comment">// end::notValidated[]</span></span><br><span class="line"><span class="meta">@Validated</span></span><br><span class="line"><span class="comment">//tag::notValidated[]</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderProps</span> </span>&#123;</span><br><span class="line">  </span><br><span class="line"><span class="comment">//end::notValidated[]</span></span><br><span class="line">  <span class="meta">@Min</span>(value=<span class="number">5</span>, message=<span class="string">"must be between 5 and 25"</span>)</span><br><span class="line">  <span class="meta">@Max</span>(value=<span class="number">25</span>, message=<span class="string">"must be between 5 and 25"</span>)</span><br><span class="line"><span class="comment">//tag::notValidated[]</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">int</span> pageSize = <span class="number">20</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后注入到Controller中即可</p>
<h4 id="5-2-2-声明配置属性元数据"><a href="#5-2-2-声明配置属性元数据" class="headerlink" title="5.2.2 声明配置属性元数据"></a>5.2.2 声明配置属性元数据</h4><p>​    缺少元数据，会出现警告。</p>
<p><img src="https://pic.imgdb.cn/item/5f22c67514195aa594300dc5.jpg" alt=""></p>
<p>​    创建自定义配置属性的元数据，需要在WEB-INF下创建一个additionnal-spring-configuration-metadata.json文件。</p>
<p><img src="https://pic.imgdb.cn/item/5f22c70014195aa594304c81.jpg" alt=""></p>
<p><img src="https://pic.imgdb.cn/item/5f22c70f14195aa5943051de.jpg" alt=""></p>
<p>​    利用ide的一些快捷功能，可以快速创建元数据文件。</p>
<h3 id="5-3-使用profile进行配置"><a href="#5-3-使用profile进行配置" class="headerlink" title="5.3  使用profile进行配置"></a>5.3  使用profile进行配置</h3><p>​    应用部署到不同环境时，数据库的细节在开发环境和质量保证环境中可能就不相同。</p>
<h4 id="5-3-1-定义特定profile的属性"><a href="#5-3-1-定义特定profile的属性" class="headerlink" title="5.3.1  定义特定profile的属性"></a>5.3.1  定义特定profile的属性</h4><p>文件名称要遵守如下的约定：</p>
<p>​    application-{profile名}.yml</p>
<p>​    比如application-prod.yml</p>
<h4 id="5-3-2-激活profile"><a href="#5-3-2-激活profile" class="headerlink" title="5.3.2 激活profile"></a>5.3.2 激活profile</h4><p>​    在application.yml这样设置</p>
<p><img src="https://pic.imgdb.cn/item/5f22cbf014195aa594323f88.jpg" alt=""></p>
<p>​    这样设置比较糟糕。</p>
<p>​    在生产环境可以这样设置</p>
<p><img src="https://pic.imgdb.cn/item/5f22cc2a14195aa594325955.jpg" alt=""></p>
<p>​    如果想激活多个profile</p>
<p><img src="https://pic.imgdb.cn/item/5f22cc4314195aa59432631b.jpg" alt=""></p>
<h4 id="5-3-3-使用profile条件化地创建bean"><a href="#5-3-3-使用profile条件化地创建bean" class="headerlink" title="5.3.3 使用profile条件化地创建bean"></a>5.3.3 使用profile条件化地创建bean</h4><p>​    在Bean上使用@Profile注解</p>
<p>​    </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@Profile(&quot;dev&quot;)</span><br><span class="line"></span><br><span class="line">@Profile(&#123;&quot;dev&quot;, &quot;qa&quot;&#125;)</span><br><span class="line"></span><br><span class="line">@Profile(&quot;! prod&quot;)</span><br></pre></td></tr></table></figure>



<h1 id="第2部分-Spring集成"><a href="#第2部分-Spring集成" class="headerlink" title="第2部分 Spring集成"></a>第2部分 Spring集成</h1><h2 id="第6章-创建REST服务"><a href="#第6章-创建REST服务" class="headerlink" title="第6章 创建REST服务"></a>第6章 创建REST服务</h2><p>​    本章内容：</p>
<ul>
<li>在Spring MVC中定义REST端点</li>
<li>启用超链接REST资源</li>
<li>自动化基于repository的REST端点</li>
</ul>
<h3 id="6-1-编写RESTful控制器"><a href="#6-1-编写RESTful控制器" class="headerlink" title="6.1  编写RESTful控制器"></a>6.1  编写RESTful控制器</h3><h5 id="6-1-1-从服务器中检索数据"><a href="#6-1-1-从服务器中检索数据" class="headerlink" title="6.1.1 从服务器中检索数据"></a>6.1.1 从服务器中检索数据</h5><p>​    用@RestController修饰Controller。</p>
<p>​    它会告诉Spring，所有处理器方法的返回值都要直接写入响应体中，而不是将值放入模型中并传递给一个视图以便进行渲染。</p>
<p>​    如果不加该注解，那么需要为每个方法都添加@ResponseBody注解。</p>
<p>​    另外一个方案是返回ResponseEntity对象。</p>
<h5 id="6-1-2-发送数据到服务端"><a href="#6-1-2-发送数据到服务端" class="headerlink" title="6.1.2 发送数据到服务端"></a>6.1.2 发送数据到服务端</h5><p>略</p>
<h5 id="6-1-3-在服务器上更新数据"><a href="#6-1-3-在服务器上更新数据" class="headerlink" title="6.1.3 在服务器上更新数据"></a>6.1.3 在服务器上更新数据</h5><p>略</p>
<h5 id="6-1-4-删除服务器上的数据"><a href="#6-1-4-删除服务器上的数据" class="headerlink" title="6.1.4 删除服务器上的数据"></a>6.1.4 删除服务器上的数据</h5><p>略</p>
<h3 id="6-2-启用超媒体"><a href="#6-2-启用超媒体" class="headerlink" title="6.2 启用超媒体"></a>6.2 启用超媒体</h3><p>​    超媒体作为应用状态引起（HATEOAS）是一种创建自描述API的方式。</p>
<p>​    如果客户端想要某个数据，URL就要以http://或者https://前缀然后添加主机名。</p>
<p>​    如果启用了超媒体功能，API将会描述自己的URL，减轻客户端对其硬编码的痛苦。</p>
<p>​    <img src="https://pic.imgdb.cn/item/5f22d1b914195aa594352ac8.jpg" alt=""></p>
<p>​    每个元素都包含了一个self连接，来引用该资源。整个列表还有一个recents属性，来引用该API自身。</p>
<p>​    如果要启用超媒体功能，添加如下依赖。</p>
<p><img src="https://pic.imgdb.cn/item/5f22d24c14195aa59435b5eb.jpg" alt=""></p>
<h5 id="6-2-1-添加超链接"><a href="#6-2-1-添加超链接" class="headerlink" title="6.2.1 添加超链接"></a>6.2.1 添加超链接</h5><p>​    Spring HATEOAS提供了两个主要类型来表示超链接资源：Resource和Resources。</p>
<p>​    <img src="https://pic.imgdb.cn/item/5f22d29f14195aa59435e928.jpg" alt=""></p>
<p>这么写，会返回如下json片段</p>
<p><img src="https://pic.imgdb.cn/item/5f22d2c714195aa59435fb8d.jpg" alt=""></p>
<p>​    但是直接传递localhost比较糟糕。使用构建者ControllerLinkBuilder效果更好，它可以自动探知主机名是什么。</p>
<p>​    <img src="https://pic.imgdb.cn/item/5f22d31814195aa594361cac.jpg" alt=""></p>
<p>或者</p>
<p><img src="https://pic.imgdb.cn/item/5f22d33f14195aa594362c92.jpg" alt=""></p>
<p><img src="https://pic.imgdb.cn/item/5f22d36514195aa594363c30.jpg" alt=""></p>
<h5 id="6-2-2-创建资源装配器"><a href="#6-2-2-创建资源装配器" class="headerlink" title="6.2.2 创建资源装配器"></a>6.2.2 创建资源装配器</h5><p>​    将资源装配定义为一个装配的工具类。</p>
<p>​    代码略</p>
<h5 id="6-2-3-命名嵌套式的关联关系"><a href="#6-2-3-命名嵌套式的关联关系" class="headerlink" title="6.2.3 命名嵌套式的关联关系"></a>6.2.3 命名嵌套式的关联关系</h5><p>​    @Relation注解可以帮助我们消除JSON字段名和Java代码定义的资源集合之间的耦合。</p>
<p>​    <img src="https://pic.imgdb.cn/item/5f22d4ab14195aa59436bf5f.jpg" alt=""></p>
<p>​    </p>
<p>​    可以指定在Resource对象中引用TacoResource对象列表时它应该被命名为tacos，如果是单个引用，名称将会是taco。</p>
<h3 id="6-3-启用数据后端服务"><a href="#6-3-启用数据后端服务" class="headerlink" title="6.3 启用数据后端服务"></a>6.3 启用数据后端服务</h3><p>​    Spring Data Rest可以为Spring Data创建的Repository自动生成REST API。</p>
<p>​    <img src="https://pic.imgdb.cn/item/5f22d54414195aa59436faa6.jpg" alt=""></p>
<p>​    似懂非懂，但是感觉用不上。</p>
<h4 id="6-3-1-调整资源路径和关系名称"><a href="#6-3-1-调整资源路径和关系名称" class="headerlink" title="6.3.1 调整资源路径和关系名称"></a>6.3.1 调整资源路径和关系名称</h4><p>​    <img src="https://pic.imgdb.cn/item/5f22d8af14195aa594385d91.jpg" alt=""></p>
<h4 id="6-3-2-分页和排序"><a href="#6-3-2-分页和排序" class="headerlink" title="6.3.2 分页和排序"></a>6.3.2 分页和排序</h4><p>略</p>
<h4 id="6-3-3-添加自定义的端点"><a href="#6-3-3-添加自定义的端点" class="headerlink" title="6.3.3  添加自定义的端点"></a>6.3.3  添加自定义的端点</h4><p>​    @RepositoryRestController</p>
<h4 id="6-3-4-为Spring-Data端点添加自定义的超链接"><a href="#6-3-4-为Spring-Data端点添加自定义的超链接" class="headerlink" title="6.3.4 为Spring Data端点添加自定义的超链接"></a>6.3.4 为Spring Data端点添加自定义的超链接</h4><p>略</p>
<h2 id="第7章-消费REST服务"><a href="#第7章-消费REST服务" class="headerlink" title="第7章 消费REST服务"></a>第7章 消费REST服务</h2><p>​    本章内容：</p>
<ul>
<li>使用RestTempldate消费REST API</li>
<li>使用Traverson导航超媒体API</li>
</ul>
<p>​    Spring可以采用多种方式来消费REST API，包括:</p>
<ul>
<li>RestTemplate: Spring核心框架提供的简单、同步REST客户端</li>
<li>Traverson：Spring HATEOAS提供的支持超链接、同步的REST客户端，其灵感来源于同名的JavaScript库。</li>
<li>WebClient：Spring 5所引入的反应式、异步REST客户端。</li>
</ul>
<h3 id="7-1-使用RestTemplate消费Rest端点"><a href="#7-1-使用RestTemplate消费Rest端点" class="headerlink" title="7.1 使用RestTemplate消费Rest端点"></a>7.1 使用RestTemplate消费Rest端点</h3><p><img src="https://pic.imgdb.cn/item/5f2432e614195aa594b76c30.jpg" alt=""></p>
<p><img src="https://pic.imgdb.cn/item/5f24331714195aa594b77b11.jpg" alt=""></p>
<p><img src="https://pic.imgdb.cn/item/5f24332914195aa594b780b8.jpg" alt=""></p>
<p>​    要是用RestTemplate可以new一个实例或者注入到Bean中。</p>
<p><img src="https://pic.imgdb.cn/item/5f24337214195aa594b79cc8.jpg" alt=""></p>
<h4 id="7-1-1-GET资源"><a href="#7-1-1-GET资源" class="headerlink" title="7.1.1 GET资源"></a>7.1.1 GET资源</h4><p>可变参数列表</p>
<p><img src="https://pic.imgdb.cn/item/5f24360614195aa594b8b611.jpg" alt=""></p>
<p>MAP指定变量</p>
<p><img src="https://pic.imgdb.cn/item/5f2436b614195aa594b8eaca.jpg" alt=""></p>
<p><img src="https://pic.imgdb.cn/item/5f2436c314195aa594b8efec.jpg" alt=""></p>
<p>UriComponentBuilder</p>
<p><img src="https://pic.imgdb.cn/item/5f2436d814195aa594b8f87b.jpg" alt=""></p>
<p>GetForEntity和GetForObject很像</p>
<p><img src="https://pic.imgdb.cn/item/5f24372714195aa594b915ba.jpg" alt=""></p>
<h4 id="7-1-2-PUT资源"><a href="#7-1-2-PUT资源" class="headerlink" title="7.1.2 PUT资源"></a>7.1.2 PUT资源</h4><p>与getForObject以及getForEntity类似。</p>
<p>方法是put。</p>
<h4 id="7-1-3-DELETE资源"><a href="#7-1-3-DELETE资源" class="headerlink" title="7.1.3 DELETE资源"></a>7.1.3 DELETE资源</h4><p>方法是delete，使用方法同上。</p>
<h4 id="7-1-4-POST资源"><a href="#7-1-4-POST资源" class="headerlink" title="7.1.4 POST资源"></a>7.1.4 POST资源</h4><p>postForEntity</p>
<p>postForObject</p>
<p>postForLocation</p>
<p>最后不是返回资源本身而是新创建资源的URI。</p>
<h3 id="7-2-使用Traverson导航REST-API"><a href="#7-2-使用Traverson导航REST-API" class="headerlink" title="7.2  使用Traverson导航REST API"></a>7.2  使用Traverson导航REST API</h3><p>略</p>
<h3 id="第8章-发送异步消息"><a href="#第8章-发送异步消息" class="headerlink" title="第8章 发送异步消息"></a>第8章 发送异步消息</h3><p>略</p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Spring/" rel="tag"># Spring</a>
          
            <a href="/tags/Spring%E5%AE%9E%E6%88%98/" rel="tag"># Spring实战</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2020/06/15/%E6%8C%91%E6%88%98%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%AB%9E%E8%B5%9B%E7%AC%94%E8%AE%B0/" rel="next" title="挑战程序设计竞赛笔记">
                <i class="fa fa-chevron-left"></i> 挑战程序设计竞赛笔记
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2020/07/21/spring-cloud-stream-with-rocketmq/" rel="prev" title="spring cloud stream with rocketmq">
                spring cloud stream with rocketmq <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
    </div>
  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/timg.jpg"
                alt="宋梓立 sorie" />
            
              <p class="site-author-name" itemprop="name">宋梓立 sorie</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives">
              
                  <span class="site-state-item-count">43</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">53</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/Ewasong" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:819294006@qq.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#第1部分-Spring基础"><span class="nav-number">1.</span> <span class="nav-text">第1部分 Spring基础</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#第1章-Spring起步"><span class="nav-number">1.1.</span> <span class="nav-text">第1章 Spring起步</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-什么是Spring"><span class="nav-number">1.1.1.</span> <span class="nav-text">1.1 什么是Spring</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-初始化Spring应用"><span class="nav-number">1.1.2.</span> <span class="nav-text">1.2 初始化Spring应用</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-1-使用IDEA初始化Spring项目"><span class="nav-number">1.1.2.1.</span> <span class="nav-text">1.2.1 使用IDEA初始化Spring项目</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-2-确认Spring项目结果"><span class="nav-number">1.1.2.2.</span> <span class="nav-text">1.2.2 确认Spring项目结果</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#探索构建规范"><span class="nav-number">1.1.2.2.1.</span> <span class="nav-text">探索构建规范</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#测试应用"><span class="nav-number">1.1.2.2.2.</span> <span class="nav-text">测试应用</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-编写Spring应用"><span class="nav-number">1.1.3.</span> <span class="nav-text">1.3 编写Spring应用</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-3-1-处理Web请求"><span class="nav-number">1.1.3.1.</span> <span class="nav-text">1.3.1 处理Web请求</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-3-2-定义视图"><span class="nav-number">1.1.3.2.</span> <span class="nav-text">1.3.2 定义视图</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-3-3-测试控制器"><span class="nav-number">1.1.3.3.</span> <span class="nav-text">1.3.3 测试控制器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-3-4-构建与运行应用"><span class="nav-number">1.1.3.4.</span> <span class="nav-text">1.3.4 构建与运行应用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-3-5-了解Spring-Boot-DevTools"><span class="nav-number">1.1.3.5.</span> <span class="nav-text">1.3.5 了解Spring Boot DevTools</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#应用自动重启"><span class="nav-number">1.1.3.5.1.</span> <span class="nav-text">应用自动重启</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#浏览器自动刷新和禁用模板缓存"><span class="nav-number">1.1.3.5.2.</span> <span class="nav-text">浏览器自动刷新和禁用模板缓存</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#内置H2控制台"><span class="nav-number">1.1.3.5.3.</span> <span class="nav-text">内置H2控制台</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-3-6-回顾一下"><span class="nav-number">1.1.3.6.</span> <span class="nav-text">1.3.6 回顾一下</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-4-俯瞰Spring风景线"><span class="nav-number">1.1.4.</span> <span class="nav-text">1.4 俯瞰Spring风景线</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-4-1-Spring-核心框架"><span class="nav-number">1.1.4.1.</span> <span class="nav-text">1.4.1 Spring 核心框架</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-4-2-Spring-Boot"><span class="nav-number">1.1.4.2.</span> <span class="nav-text">1.4.2 Spring Boot</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-4-3-Spring-data"><span class="nav-number">1.1.4.3.</span> <span class="nav-text">1.4.3 Spring data</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-4-4-Spring-Security"><span class="nav-number">1.1.4.4.</span> <span class="nav-text">1.4.4 Spring Security</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-4-5-Spring-Integration和Spring-Batch"><span class="nav-number">1.1.4.5.</span> <span class="nav-text">1.4.5 Spring Integration和Spring Batch</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-4-6-Spring-Cloud"><span class="nav-number">1.1.4.6.</span> <span class="nav-text">1.4.6 Spring Cloud</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-5-小结"><span class="nav-number">1.1.5.</span> <span class="nav-text">1.5 小结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#第2章-开发Web应用"><span class="nav-number">1.2.</span> <span class="nav-text">第2章 开发Web应用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-展现信息"><span class="nav-number">1.2.1.</span> <span class="nav-text">2.1 展现信息</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-1-构建领域类"><span class="nav-number">1.2.1.1.</span> <span class="nav-text">2.1.1 构建领域类</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-2-创建控制器类"><span class="nav-number">1.2.1.2.</span> <span class="nav-text">2.1.2 创建控制器类</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#处理GET请求"><span class="nav-number">1.2.1.2.1.</span> <span class="nav-text">处理GET请求</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-3-设计视图"><span class="nav-number">1.2.1.3.</span> <span class="nav-text">2.1.3 设计视图</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-处理表单提交"><span class="nav-number">1.2.2.</span> <span class="nav-text">2.2 处理表单提交</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-校验表单输入"><span class="nav-number">1.2.3.</span> <span class="nav-text">2.3 校验表单输入</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-1-声明校验规则"><span class="nav-number">1.2.3.1.</span> <span class="nav-text">2.3.1 声明校验规则</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-2-在表单绑定时执行校验"><span class="nav-number">1.2.3.2.</span> <span class="nav-text">2.3.2 在表单绑定时执行校验</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-3-展示校验错误"><span class="nav-number">1.2.3.3.</span> <span class="nav-text">2.3.3 展示校验错误</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-4-使用视图控制器"><span class="nav-number">1.2.4.</span> <span class="nav-text">2.4 使用视图控制器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-5-选择视图模板"><span class="nav-number">1.2.5.</span> <span class="nav-text">2.5 选择视图模板</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#缓存模板"><span class="nav-number">1.2.5.1.</span> <span class="nav-text">缓存模板</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-6-小结"><span class="nav-number">1.2.6.</span> <span class="nav-text">2.6 小结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#第3章-使用数据"><span class="nav-number">1.3.</span> <span class="nav-text">第3章 使用数据</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-使用JDBC读取和写入数据"><span class="nav-number">1.3.1.</span> <span class="nav-text">3.1 使用JDBC读取和写入数据</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-1-调整领域对象以适应持久化"><span class="nav-number">1.3.1.1.</span> <span class="nav-text">3.1.1 调整领域对象以适应持久化</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-2-使用JdbcTempldate"><span class="nav-number">1.3.1.2.</span> <span class="nav-text">3.1.2 使用JdbcTempldate</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#定义JDBC-repository"><span class="nav-number">1.3.1.2.1.</span> <span class="nav-text">定义JDBC repository</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#插入一行数据"><span class="nav-number">1.3.1.2.2.</span> <span class="nav-text">插入一行数据</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-3-定义模式和加载数据"><span class="nav-number">1.3.1.3.</span> <span class="nav-text">3.1.3 定义模式和加载数据</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-使用Spring-DataJpa-持久化数据"><span class="nav-number">1.3.2.</span> <span class="nav-text">3.2 使用Spring DataJpa 持久化数据</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-1-添加Spring-Data-JPA到项目中"><span class="nav-number">1.3.2.1.</span> <span class="nav-text">3.2.1 添加Spring Data JPA到项目中</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-2-将领域类标准为实体"><span class="nav-number">1.3.2.2.</span> <span class="nav-text">3.2.2 将领域类标准为实体</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-3-声明JPA-repository"><span class="nav-number">1.3.2.3.</span> <span class="nav-text">3.2.3 声明JPA repository</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-4-自定义JPA-repository"><span class="nav-number">1.3.2.4.</span> <span class="nav-text">3.2.4 自定义JPA repository</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-小结"><span class="nav-number">1.3.3.</span> <span class="nav-text">3.3 小结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#第4章-保护Spring"><span class="nav-number">1.4.</span> <span class="nav-text">第4章 保护Spring</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-启用Spring-Security"><span class="nav-number">1.4.1.</span> <span class="nav-text">4.1 启用Spring Security</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-配置Spring-Security"><span class="nav-number">1.4.2.</span> <span class="nav-text">4.2 配置Spring Security</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-1-基于内存的用户存储"><span class="nav-number">1.4.2.1.</span> <span class="nav-text">4.2.1 基于内存的用户存储</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-2-基于JDBC的用户存储"><span class="nav-number">1.4.2.2.</span> <span class="nav-text">4.2.2 基于JDBC的用户存储</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#重写默认的用户查询功能"><span class="nav-number">1.4.2.2.1.</span> <span class="nav-text">重写默认的用户查询功能</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#使用转码后的密码"><span class="nav-number">1.4.2.2.2.</span> <span class="nav-text">使用转码后的密码</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-3-以LDAP作为后端的用户存储"><span class="nav-number">1.4.2.3.</span> <span class="nav-text">4.2.3 以LDAP作为后端的用户存储</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#配置密码比对"><span class="nav-number">1.4.2.3.1.</span> <span class="nav-text">配置密码比对</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#引用远程的LDAP服务器"><span class="nav-number">1.4.2.3.2.</span> <span class="nav-text">引用远程的LDAP服务器</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#配置嵌入式的LDAP服务器"><span class="nav-number">1.4.2.3.3.</span> <span class="nav-text">配置嵌入式的LDAP服务器</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-4-自定义用户认证"><span class="nav-number">1.4.3.</span> <span class="nav-text">4.2.4 自定义用户认证</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#定义用户领域对象和持久化"><span class="nav-number">1.4.3.0.1.</span> <span class="nav-text">定义用户领域对象和持久化</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#创建用户详情服务"><span class="nav-number">1.4.3.0.2.</span> <span class="nav-text">创建用户详情服务</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#注册用户"><span class="nav-number">1.4.3.0.3.</span> <span class="nav-text">注册用户</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-保护Web请求"><span class="nav-number">1.4.4.</span> <span class="nav-text">4.3 保护Web请求</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-3-1-保护请求"><span class="nav-number">1.4.4.1.</span> <span class="nav-text">4.3.1 保护请求</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-3-2-自定义登录页"><span class="nav-number">1.4.4.2.</span> <span class="nav-text">4.3.2 自定义登录页</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-3-3-退出"><span class="nav-number">1.4.4.3.</span> <span class="nav-text">4.3.3 退出</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-3-4-防止跨站请求伪造"><span class="nav-number">1.4.4.4.</span> <span class="nav-text">4.3.4 防止跨站请求伪造</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-4-了解用户是谁"><span class="nav-number">1.4.5.</span> <span class="nav-text">4.4 了解用户是谁</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-5-小结"><span class="nav-number">1.4.6.</span> <span class="nav-text">4.5 小结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#第5章-使用配置属性"><span class="nav-number">1.5.</span> <span class="nav-text">第5章 使用配置属性</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-1-细粒度的自动配置"><span class="nav-number">1.5.1.</span> <span class="nav-text">5.1 细粒度的自动配置</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#5-1-1-理解Spring的环境抽象"><span class="nav-number">1.5.1.1.</span> <span class="nav-text">5.1.1 理解Spring的环境抽象</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-1-2-配置数据源"><span class="nav-number">1.5.1.2.</span> <span class="nav-text">5.1.2 配置数据源</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-1-3-配置嵌入式服务器"><span class="nav-number">1.5.1.3.</span> <span class="nav-text">5.1.3 配置嵌入式服务器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-1-4-配置日志"><span class="nav-number">1.5.1.4.</span> <span class="nav-text">5.1.4 配置日志</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-1-5-使用特定的属性值"><span class="nav-number">1.5.1.5.</span> <span class="nav-text">5.1.5 使用特定的属性值</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2-创建自己的配置属性"><span class="nav-number">1.5.2.</span> <span class="nav-text">5.2 创建自己的配置属性</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#5-2-1-定义配置属性的持有者"><span class="nav-number">1.5.2.1.</span> <span class="nav-text">5.2.1 定义配置属性的持有者</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-2-2-声明配置属性元数据"><span class="nav-number">1.5.2.2.</span> <span class="nav-text">5.2.2 声明配置属性元数据</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-3-使用profile进行配置"><span class="nav-number">1.5.3.</span> <span class="nav-text">5.3  使用profile进行配置</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#5-3-1-定义特定profile的属性"><span class="nav-number">1.5.3.1.</span> <span class="nav-text">5.3.1  定义特定profile的属性</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-3-2-激活profile"><span class="nav-number">1.5.3.2.</span> <span class="nav-text">5.3.2 激活profile</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-3-3-使用profile条件化地创建bean"><span class="nav-number">1.5.3.3.</span> <span class="nav-text">5.3.3 使用profile条件化地创建bean</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#第2部分-Spring集成"><span class="nav-number">2.</span> <span class="nav-text">第2部分 Spring集成</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#第6章-创建REST服务"><span class="nav-number">2.1.</span> <span class="nav-text">第6章 创建REST服务</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#6-1-编写RESTful控制器"><span class="nav-number">2.1.1.</span> <span class="nav-text">6.1  编写RESTful控制器</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#6-1-1-从服务器中检索数据"><span class="nav-number">2.1.1.0.1.</span> <span class="nav-text">6.1.1 从服务器中检索数据</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#6-1-2-发送数据到服务端"><span class="nav-number">2.1.1.0.2.</span> <span class="nav-text">6.1.2 发送数据到服务端</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#6-1-3-在服务器上更新数据"><span class="nav-number">2.1.1.0.3.</span> <span class="nav-text">6.1.3 在服务器上更新数据</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#6-1-4-删除服务器上的数据"><span class="nav-number">2.1.1.0.4.</span> <span class="nav-text">6.1.4 删除服务器上的数据</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-2-启用超媒体"><span class="nav-number">2.1.2.</span> <span class="nav-text">6.2 启用超媒体</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#6-2-1-添加超链接"><span class="nav-number">2.1.2.0.1.</span> <span class="nav-text">6.2.1 添加超链接</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#6-2-2-创建资源装配器"><span class="nav-number">2.1.2.0.2.</span> <span class="nav-text">6.2.2 创建资源装配器</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#6-2-3-命名嵌套式的关联关系"><span class="nav-number">2.1.2.0.3.</span> <span class="nav-text">6.2.3 命名嵌套式的关联关系</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-3-启用数据后端服务"><span class="nav-number">2.1.3.</span> <span class="nav-text">6.3 启用数据后端服务</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#6-3-1-调整资源路径和关系名称"><span class="nav-number">2.1.3.1.</span> <span class="nav-text">6.3.1 调整资源路径和关系名称</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-3-2-分页和排序"><span class="nav-number">2.1.3.2.</span> <span class="nav-text">6.3.2 分页和排序</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-3-3-添加自定义的端点"><span class="nav-number">2.1.3.3.</span> <span class="nav-text">6.3.3  添加自定义的端点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-3-4-为Spring-Data端点添加自定义的超链接"><span class="nav-number">2.1.3.4.</span> <span class="nav-text">6.3.4 为Spring Data端点添加自定义的超链接</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#第7章-消费REST服务"><span class="nav-number">2.2.</span> <span class="nav-text">第7章 消费REST服务</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#7-1-使用RestTemplate消费Rest端点"><span class="nav-number">2.2.1.</span> <span class="nav-text">7.1 使用RestTemplate消费Rest端点</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#7-1-1-GET资源"><span class="nav-number">2.2.1.1.</span> <span class="nav-text">7.1.1 GET资源</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-1-2-PUT资源"><span class="nav-number">2.2.1.2.</span> <span class="nav-text">7.1.2 PUT资源</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-1-3-DELETE资源"><span class="nav-number">2.2.1.3.</span> <span class="nav-text">7.1.3 DELETE资源</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-1-4-POST资源"><span class="nav-number">2.2.1.4.</span> <span class="nav-text">7.1.4 POST资源</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-2-使用Traverson导航REST-API"><span class="nav-number">2.2.2.</span> <span class="nav-text">7.2  使用Traverson导航REST API</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#第8章-发送异步消息"><span class="nav-number">2.2.3.</span> <span class="nav-text">第8章 发送异步消息</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">宋梓立 sorie</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  









  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
  
  <script type="text/javascript">
    var GUEST = ['nick','mail','link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item=>{
      return GUEST.indexOf(item)>-1;
    });
    new Valine({
        el: '#comments' ,
        verify: false,
        notify: true,
        appId: 'XTY8e76465N8ugbyhpCoS88f-gzGzoHsz',
        appKey: 'dwWTNcurePtzzBdMO62hSRMy',
        placeholder: 'Just go go',
        avatar:'mm',
        guest_info:guest,
        pageSize:'10' || 10,
    });
  </script>



  





  

  

  

  
  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  

  

</body>
</html>
